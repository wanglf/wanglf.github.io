<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>田园牧歌</title>
    <description>Wonder is the beginning of wisdom</description>
    <link>/</link>
    <atom:link href="/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Fri, 05 Aug 2016 21:08:26 +0800</pubDate>
    <lastBuildDate>Fri, 05 Aug 2016 21:08:26 +0800</lastBuildDate>
    <generator>Jekyll v2.5.3</generator>
    
      <item>
        <title>my ubuntu desktop</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;create bootable disk&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;find disk name&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;install ubuntu16.04 os&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;install additional language and setup input method&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;install language&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;install fcitx input method&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;prepare dotfiles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;ohmyzsh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline12&quot;&gt;terminal&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;colorscheme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;dircolor&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline11&quot;&gt;font&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline13&quot;&gt;tmux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline14&quot;&gt;ssh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline22&quot;&gt;emacs&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline17&quot;&gt;install 24.5 from source&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline15&quot;&gt;prerequiste&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline16&quot;&gt;install&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline18&quot;&gt;ipython&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline19&quot;&gt;ob-shell&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline20&quot;&gt;start&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline21&quot;&gt;usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline23&quot;&gt;vim&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline24&quot;&gt;atom&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline25&quot;&gt;git&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline26&quot;&gt;tweak tool&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
This article illustrates various settings of my desktop pc whose os is ubuntu 16.04 LTS.
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;create bootable disk&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;sudo dd &lt;span style=&quot;color: #007;&quot;&gt;if&lt;/span&gt;=~/Downloads/ubuntu-16.04.1-desktop-amd64.iso &lt;span style=&quot;color: #007;&quot;&gt;of&lt;/span&gt;=/dev/rdisk2 &lt;span style=&quot;color: #007;&quot;&gt;bs&lt;/span&gt;=1m
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline2&quot;&gt;find disk name&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;dl class=&quot;org-dl&quot;&gt;
&lt;dt&gt;mac&lt;/dt&gt;&lt;dd&gt;diskutil list&lt;/dd&gt;
&lt;dt&gt;linux&lt;/dt&gt;&lt;dd&gt;ls -al /dev/sd*&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;install ubuntu16.04 os&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;p&gt;
use bootable usb disk to install operating system
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;install additional language and setup input method&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline4&quot;&gt;install language&lt;/h3&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline5&quot;&gt;install fcitx input method&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;sudo apt-get install fcitx fcitx-config-gtk fcitx-sunpinyin fcitx-googlepinyin fcitx-module-cloudpinyin im-config
sudo im-config -s fcitx -z default
sudo reboot
&lt;/pre&gt;
&lt;/div&gt;

&lt;dl class=&quot;org-dl&quot;&gt;
&lt;dt&gt;CTRL + SPACE&lt;/dt&gt;&lt;dd&gt;switch language&lt;/dd&gt;
&lt;dt&gt;CTRL + SHIFT&lt;/dt&gt;&lt;dd&gt;switch input method&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline7&quot;&gt;prepare dotfiles&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;sudo apt-get install git
sudo mkdir -p /opt/git
sudo chown -R wesley:wesley /opt/git
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /opt/git
git clone git@github.com:wanglf/dotfiles.git dotfiles.git
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline8&quot;&gt;ohmyzsh&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;sudo apt-get install zsh
ln -s /opt/git/dotfiles.git/ohmyzsh/.zshrc ~
cp /opt/git/dotfiles.git/ohmyzsh/.cusomrc ~
chsh -s /bin/zsh
sudo reboot
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline12&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline12&quot;&gt;terminal&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline12&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline9&quot;&gt;colorscheme&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /opt/git/dotfiles.git/gnome-terminal
./install.sh
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline10&quot;&gt;dircolor&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;ln -s /opt/git/dotfiles.git/dircolors-solarized/dircolors.256dark ~/.dircolors.256dark
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline11&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline11&quot;&gt;font&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline11&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;mkdir -p ~/.fonts
cp /opt/git/dotfiles.git/fonts/sauce_code_powerline_regular.otf ~/.fonts/
sudo fc-cache -f -v
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline13&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline13&quot;&gt;tmux&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline13&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;sudo apt-get install tmux
ln -s /opt/git/dotfiles.git/tmux/.tmux.conf ~
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline14&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline14&quot;&gt;ssh&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline14&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;cp /opt/git/dotfiles.git/ssh/config ~/.ssh/
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline22&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline22&quot;&gt;emacs&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline22&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline17&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline17&quot;&gt;install 24.5 from source&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline17&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline15&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline15&quot;&gt;prerequiste&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline15&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;sudo apt-get install libxpm-dev libjpeg62-dev libgif-dev libtiff4-dev libpng16-dev
sudo apt-get install libncurses-dev
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline16&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline16&quot;&gt;install&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline16&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; emacs-24.5
./configure --with-x-toolkit=no
make
sudo make install
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline18&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline18&quot;&gt;ipython&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline18&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;sudo apt-get install python-pip
tar xvf ipython-3.2.1.tar.gz
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; ipython-3.2.1
python setup.py install
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline19&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline19&quot;&gt;ob-shell&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline19&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;scp root@devsrv:/opt/download/ob-shell.el /usr/local/share/emacs/24.5/lisp/org
scp root@devsrv:/opt/download/ob-shell.elc /usr/local/share/emacs/24.5/lisp/org
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline20&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline20&quot;&gt;start&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline20&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;rm ~/.emacs.d
ln -s /opt/git/dotfiles.git/emacs.d ~/.emacs.d
emacs
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
wait emacs to install elpa packages
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline21&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline21&quot;&gt;usage&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline21&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;in ~/.customrc add following 3 aliases&lt;/span&gt;
&lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;alias emacsd=&#39;emacs -nw --daemon --no-desktop&#39;&lt;/span&gt;
&lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;alias killemacs=&#39;kill -9 `pidof emacs`&#39;&lt;/span&gt;
&lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;alias ec=&#39;TERM=xterm-256color emacsclient -t&#39;&lt;/span&gt;
emacsd
ec
killemacs
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline23&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline23&quot;&gt;vim&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline23&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;mkdir -p ~/.vim/bundle/ &amp;amp;&amp;amp; &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; ~/.vim/bundle/
git clone https://github.com/gmarik/Vundle.vim.git
ln -s /opt/git/dotfiles.git/vim/.vimrc ~/
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
int vim command mode issue &lt;b&gt;PluginInstall&lt;/b&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline24&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline24&quot;&gt;atom&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline24&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;cp /opt/git/dotfiles.git/atom/.apmrc ~/.atom/
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
install following packages:
&lt;/p&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;vim-mode&lt;/li&gt;
&lt;li&gt;ex-mode&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline25&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline25&quot;&gt;git&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline25&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;cp /opt/git/dotfiles.git/git/.gitconfig ~/
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline26&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline26&quot;&gt;tweak tool&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline26&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;sudo apt-get install gnome-tweak-tool
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;
open gnome-tweak-tool, goto Typing menu, Caps Lock key behavior
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Fri, 05 Aug 2016 00:00:00 +0800</pubDate>
        <link>/linux/my-ubuntu-desktop.html</link>
        <guid isPermaLink="true">/linux/my-ubuntu-desktop.html</guid>
        
        <category>ubuntu</category>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>Bind DNS服务器学习笔记</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline13&quot;&gt;DNS术语&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;Root&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;TLD域名&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;Master&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;Slave&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;Forward&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;Zone&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;纪录类型&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;A纪录&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;AAAA纪录&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;NS纪录&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline11&quot;&gt;CNAME&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline12&quot;&gt;FQDN&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline18&quot;&gt;实际架构&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline14&quot;&gt;一主两从&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline15&quot;&gt;VIEW功能&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline16&quot;&gt;禁用forward&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline17&quot;&gt;IP地址分配&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline26&quot;&gt;服务器主要配置&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline19&quot;&gt;注释格式&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline20&quot;&gt;master /etc/named.conf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline21&quot;&gt;slave /etc/named.conf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline25&quot;&gt;zone文件&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline22&quot;&gt;位置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline23&quot;&gt;示例&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline24&quot;&gt;域名规范&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline29&quot;&gt;客户端配置&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline27&quot;&gt;卸载NetworkManager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline28&quot;&gt;/etc/resolv.conf&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline40&quot;&gt;日常维护&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline30&quot;&gt;增加纪录&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline31&quot;&gt;修改sc.named.abc.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline32&quot;&gt;修改oa.named.abc.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline33&quot;&gt;修改SERIAL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline34&quot;&gt;查看前后差异&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline35&quot;&gt;重新加载文件&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline36&quot;&gt;备份&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline37&quot;&gt;监控&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline38&quot;&gt;日志文件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline39&quot;&gt;诊断工具&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline41&quot;&gt;ansible自动安装脚本&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline44&quot;&gt;最佳实践&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline42&quot;&gt;最小化重启&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline43&quot;&gt;隐藏primary server&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline45&quot;&gt;参考资料&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
DNS是构建互联网的基础，而bind是DNS服务器软件中历史最悠久，市场占用率最高的产品，在此纪录学习过程中的一些笔记。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline13&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline13&quot;&gt;DNS术语&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline13&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline1&quot;&gt;Root&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;p&gt;
DNS的根为英文句点&quot;.&quot; , 目前全球共有12家组织，提供13个根服务器。比如通过在互联网任一Linux机器上使用dig +trace @8.8.8.8 www.baidu.com可以看到各根域名服务器情况。
&lt;/p&gt;

&lt;p&gt;
根服务器分布如下:
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
A - VeriSign Global Registry Services
B - University of Southern California - Information Sciences Institute
C - Cogent Communications
D - University of Maryland
E - NASA Ames Research Center
F - Internet Systems Consortium, Inc.
G - U.S. DOD Network Information Center
H - U.S. Army Research Lab
I - Autonomica/NORDUnet
J - VeriSign Global Registry Services
K - RIPE NCC
L - ICANN
M - WIDE Project
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline2&quot;&gt;TLD域名&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
.com, .edu. .cn等均为顶级域名(TLD)，由域名机构管理者维护。一般申请者只能申请到二级域名，例如abc.com。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline3&quot;&gt;Master&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;p&gt;
主DNS服务器，一般由其维护DNS纪录。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline4&quot;&gt;Slave&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;p&gt;
从DNS服务器，一般通过zone transfer实现从主服务器自动同步，通讯端口为tcp 53。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline5&quot;&gt;Forward&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;p&gt;
当本地不存在纪录时，是否向上游转发。典型的运营商的DNS服务器一般为forward only，本身不维护任何纪录，只负责向上游转发。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline6&quot;&gt;Zone&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;p&gt;
一般一个域名就是一个zone，同时会有对应的zone文件用于维护纪录。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline7&quot;&gt;纪录类型&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;p&gt;
最常用的有如下几种，其他类型此处不再列出
&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline8&quot;&gt;A纪录&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;p&gt;
address的缩写，代表一个域名所对应的IP地址，最常用的类型
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline9&quot;&gt;AAAA纪录&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;p&gt;
类似于A纪录，不过用于ipv6地址的解析
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline10&quot;&gt;NS纪录&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;p&gt;
name server的缩写，一般用于指定DNS服务器的域名或者指派子域名
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline11&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline11&quot;&gt;CNAME&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline11&quot;&gt;
&lt;p&gt;
canonical name的缩写，简单理解就是别名。比如各大互联网公司经常将其用于门户的入口，这样带来的好处是对外保持域名不变，通过映射关系实现灵活切换。通过如下命令可查看cname的一个示例:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;dig @8.8.8.8 www.163.com
&lt;/pre&gt;
&lt;/div&gt;

&lt;pre class=&quot;example&quot;&gt;
www.163.com.    0    IN    CNAME    www.163.com.lxdns.com.
www.163.com.lxdns.com.    0    IN    CNAME    163.xdwscache.ourglb0.com
163.xdwscache.ourglb0.com.    51    IN    A      183.134.16.86
163.xdwscache.ourglb0.com.    51    IN    A      115.231.22.80
&lt;/pre&gt;

&lt;p&gt;
代表www.163.com的别名为www.163.com.lxdns.com，同时www.163.com.lxdns.com的别名又指向163.xdwscache.ourglb0.com, 最终通过解析163.xdwscache.ourglb0.com的域名获得实际IP有两个。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline12&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline12&quot;&gt;FQDN&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline12&quot;&gt;
&lt;p&gt;
完整域名，例如: ntp01.abc.com，FQDN为: ntp01.abc.com. ， 主机部分为ntp01。 如果在/etc/resolv.conf中配置了search abc.com，此时ping ntp01与ntp01.abc.com均可返回对应的IP地址。实际使用建议采用完整域名，减少可能发生的分歧。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline18&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline18&quot;&gt;实际架构&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline18&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline14&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline14&quot;&gt;一主两从&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline14&quot;&gt;
&lt;p&gt;
Bind name server采用一主两从模式。Master修改zone文件后，通过信令自动同步至slave服务器。首次安装完成后，slave服务器不再做任何变更，所有变更操作均在master服务器上完成。Master服务器不向外暴露，只有两个slave服务器提供查询服务。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline15&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline15&quot;&gt;VIEW功能&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline15&quot;&gt;
&lt;p&gt;
Bind name server 启用VIEW功能。举个例子，针对ntp01.abc.com的请求，如果客户端源地址是192.168.11.126，此时命中acl sc，将返回sc-view中对应的纪录，此时读取的zone文件是sc.named.abc.com。如果客户端源地址是172.16.138.71，此时命中的acl oa，将返回oa-view中对应的纪录，此时读取的zone文件为oa.named.abc.com。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline16&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline16&quot;&gt;禁用forward&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline16&quot;&gt;
&lt;p&gt;
由于是一个封闭的系统，不启用forward功能，所有纪录都通过本地文件或缓存解析。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline17&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline17&quot;&gt;IP地址分配&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline17&quot;&gt;
&lt;dl class=&quot;org-dl&quot;&gt;
&lt;dt&gt;Master&lt;/dt&gt;&lt;dd&gt;192.168.1.63&lt;/dd&gt;
&lt;dt&gt;Slave&lt;/dt&gt;&lt;dd&gt;192.168.1.61/192.168.1.62&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline26&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline26&quot;&gt;服务器主要配置&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline26&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline19&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline19&quot;&gt;注释格式&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline19&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
/* This is a C-style comment */
// This is a c++-style comment
# This is a shell-style comment
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline20&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline20&quot;&gt;master /etc/named.conf&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline20&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;key &lt;span style=&quot;color: #800;&quot;&gt;&quot;sc-key&quot;&lt;/span&gt; {
    algorithm HMAC-MD5;
    secret &lt;span style=&quot;color: #800;&quot;&gt;&quot;ZUZdBP96TP+bXUGA+TaVuRMLitTrxz5aM08mxd8u3mI=&quot;&lt;/span&gt;;
};

key &lt;span style=&quot;color: #800;&quot;&gt;&quot;oa-key&quot;&lt;/span&gt; {
    algorithm HMAC-MD5;
    secret &lt;span style=&quot;color: #800;&quot;&gt;&quot;LZdRodIo1LCSYZMYnAta8270RFn8cUgZoL96W5LWNVU=&quot;&lt;/span&gt;;
};

options {
    listen-on port 53 {
        any;
    };
    directory   &lt;span style=&quot;color: #800;&quot;&gt;&quot;/var/named&quot;&lt;/span&gt;;
    dump-file   &lt;span style=&quot;color: #800;&quot;&gt;&quot;/var/named/data/cache_dump.db&quot;&lt;/span&gt;;
    statistics-file &lt;span style=&quot;color: #800;&quot;&gt;&quot;/var/named/data/named_stats.txt&quot;&lt;/span&gt;;
    memstatistics-file &lt;span style=&quot;color: #800;&quot;&gt;&quot;/var/named/data/named_mem_stats.txt&quot;&lt;/span&gt;;
    allow-query {
        any;
    };
    recursion no;
    notify explicit; // default yes, notify nameserver which has NS records
    allow-transfer {
        none;
    };
    managed-keys-directory &lt;span style=&quot;color: #800;&quot;&gt;&quot;/var/named/dynamic&quot;&lt;/span&gt;;
    pid-file &lt;span style=&quot;color: #800;&quot;&gt;&quot;/run/named/named.pid&quot;&lt;/span&gt;;
    session-keyfile &lt;span style=&quot;color: #800;&quot;&gt;&quot;/run/named/session.key&quot;&lt;/span&gt;;
};

logging {
    channel default_debug {
        file &lt;span style=&quot;color: #800;&quot;&gt;&quot;data/named.run&quot;&lt;/span&gt;;
        severity dynamic;
    };
};

acl sc {
    &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt;key oa-key;
    key sc-key;
    localhost;
    192.168.0.0/16;
};

acl oa {
    &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt;key sc-key;
    key oa-key;
    172.16.0.0/16;
};

view &lt;span style=&quot;color: #800;&quot;&gt;&quot;sc-view&quot;&lt;/span&gt; {
    match-clients {
        sc;
    };
    allow-transfer {
        key sc-key;
    };
    zone &lt;span style=&quot;color: #800;&quot;&gt;&quot;abc.com&quot;&lt;/span&gt; IN {
        &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;type&lt;/span&gt; master;
        file &lt;span style=&quot;color: #800;&quot;&gt;&quot;sc.named.abc.com&quot;&lt;/span&gt;;
        also-notify {
            192.168.1.61 key sc-key;
            192.168.1.62 key sc-key;
        };
        zone-statistics yes;
    };
};

view &lt;span style=&quot;color: #800;&quot;&gt;&quot;oa-view&quot;&lt;/span&gt; {
    match-clients {
        oa;
    };
    allow-transfer {
        key oa-key;
    };
    zone &lt;span style=&quot;color: #800;&quot;&gt;&quot;abc.com&quot;&lt;/span&gt; IN {
        &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;type&lt;/span&gt; master;
        file &lt;span style=&quot;color: #800;&quot;&gt;&quot;oa.named.abc.com&quot;&lt;/span&gt;;
        also-notify {
            192.168.1.61 key oa-key;
            192.168.1.62 key oa-key;
        };
        zone-statistics yes;
    };
};

controls {
    inet 127.0.0.1 port 953 allow {
        127.0.0.1;
    };
};

statistics-channels {
    inet 0.0.0.0 port 8053 allow {
        localhost;
        192.168.11.0/24;
    };
};
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline21&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline21&quot;&gt;slave /etc/named.conf&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline21&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;key &lt;span style=&quot;color: #800;&quot;&gt;&quot;sc-key&quot;&lt;/span&gt; {
    algorithm HMAC-MD5;
    secret &lt;span style=&quot;color: #800;&quot;&gt;&quot;ZUZdBP96TP+bXUGA+TaVuRMLitTrxz5aM08mxd8u3mI=&quot;&lt;/span&gt;;
};

key &lt;span style=&quot;color: #800;&quot;&gt;&quot;oa-key&quot;&lt;/span&gt; {
    algorithm HMAC-MD5;
    secret &lt;span style=&quot;color: #800;&quot;&gt;&quot;LZdRodIo1LCSYZMYnAta8270RFn8cUgZoL96W5LWNVU=&quot;&lt;/span&gt;;
};

options {
    listen-on port 53 {
        any;
    };
    directory   &lt;span style=&quot;color: #800;&quot;&gt;&quot;/var/named&quot;&lt;/span&gt;;
    dump-file   &lt;span style=&quot;color: #800;&quot;&gt;&quot;/var/named/data/cache_dump.db&quot;&lt;/span&gt;;
    statistics-file &lt;span style=&quot;color: #800;&quot;&gt;&quot;/var/named/data/named_stats.txt&quot;&lt;/span&gt;;
    memstatistics-file &lt;span style=&quot;color: #800;&quot;&gt;&quot;/var/named/data/named_mem_stats.txt&quot;&lt;/span&gt;;
    allow-query {
        any;
    };
    allow-transfer {
        none;
    };
    recursion no;
    notify explicit;
    managed-keys-directory &lt;span style=&quot;color: #800;&quot;&gt;&quot;/var/named/dynamic&quot;&lt;/span&gt;;
    pid-file &lt;span style=&quot;color: #800;&quot;&gt;&quot;/run/named/named.pid&quot;&lt;/span&gt;;
    session-keyfile &lt;span style=&quot;color: #800;&quot;&gt;&quot;/run/named/session.key&quot;&lt;/span&gt;;
};

logging {
    channel default_debug {
        file &lt;span style=&quot;color: #800;&quot;&gt;&quot;data/named.run&quot;&lt;/span&gt;;
        severity dynamic;
    };
};

acl sc {
    &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt;key oa-key;
    key sc-key;
    127.0.0.0/8;
    192.168.0.0/16;
};

acl oa {
    &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt;key sc-key;
    key oa-key;
    172.16.0.0/16;
};

view &lt;span style=&quot;color: #800;&quot;&gt;&quot;sc-view&quot;&lt;/span&gt; {
    match-clients {
        sc;
    };
    zone &lt;span style=&quot;color: #800;&quot;&gt;&quot;abc.com&quot;&lt;/span&gt; IN {
        file &lt;span style=&quot;color: #800;&quot;&gt;&quot;slaves/bak.sc.named.abc.com&quot;&lt;/span&gt;;
        &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;type&lt;/span&gt; slave;
        masterfile-format text;
        masters {
            192.168.1.63 key sc-key;
        };
        zone-statistics yes;
    };
};

view &lt;span style=&quot;color: #800;&quot;&gt;&quot;oa-view&quot;&lt;/span&gt; {
    match-clients {
        oa;
    };

    zone &lt;span style=&quot;color: #800;&quot;&gt;&quot;abc.com&quot;&lt;/span&gt; IN {
        file &lt;span style=&quot;color: #800;&quot;&gt;&quot;slaves/bak.oa.named.abc.com&quot;&lt;/span&gt;;
        &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;type&lt;/span&gt; slave;
        masterfile-format text;
        masters {
            192.168.1.63 key oa-key;
        };
        zone-statistics yes;
    };
};

controls {
    inet 127.0.0.1 port 953 allow {
        127.0.0.1;
    };
};

statistics-channels {
    inet 0.0.0.0 port 8053 allow {
        localhost;
        192.168.11.0/24;
    };
};
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline25&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline25&quot;&gt;zone文件&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline25&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline22&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline22&quot;&gt;位置&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline22&quot;&gt;
&lt;dl class=&quot;org-dl&quot;&gt;
&lt;dt&gt;master&lt;/dt&gt;&lt;dd&gt;/var/named&lt;/dd&gt;
&lt;dt&gt;slave:&lt;/dt&gt;&lt;dd&gt;/var/named/slaves&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline23&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline23&quot;&gt;示例&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline23&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;$&lt;span style=&quot;color: #007;&quot;&gt;TTL&lt;/span&gt; 1D
@       IN SOA  @ wanglifeng_abc.com. (
                                        2016071908       ; serial YYYYMMDDNN
                                        1D      ; refresh
                                        1H      ; retry
                                        30D     ; expire
                                        3H )    ; negative caching ttl
@                                       IN NS  ns00.abc.com.
@                                       IN NS  ns01.abc.com.
@                                       IN NS  ns02.abc.com.
ns00.abc.com. IN A 192.168.1.63
ns01.abc.com. IN A 192.168.1.61
ns02.abc.com. IN A 192.168.1.62
ntp01   IN      A  192.168.4.11
ntp02   IN      A  192.168.4.12
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline24&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline24&quot;&gt;域名规范&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline24&quot;&gt;
&lt;p&gt;
域名建议采用如下格式:
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;A.B.C.abc.com
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;
其中A代表主机名称，B代表应用名称,C代表环境(test,dev，生产环境为空)，例如:
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;db01.appname.abc.com
db01.appname.test.abc.com
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
一些公共环境，可以省略应用名称，例如:
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;ntp01.abc.com
ftp.abc.com
lb01.abc.com
lb01.test.abc.com
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
zone文件维护:
&lt;/p&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;建议按照IP地址大小，按升序排列&lt;/li&gt;
&lt;li&gt;所有域名采用小写&lt;/li&gt;
&lt;li&gt;第一个与第二个字段采用三个tab分隔，后面的字段单个TAB分隔&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline29&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline29&quot;&gt;客户端配置&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline29&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline27&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline27&quot;&gt;卸载NetworkManager&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline27&quot;&gt;
&lt;p&gt;
Redhat/Centos系列，一般建议不管是否配置DNS均卸载如下三个软件包:
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;yum -y remove NetworkManager-tui NetworkManager-libnm NetworkManager
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline28&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline28&quot;&gt;/etc/resolv.conf&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline28&quot;&gt;
&lt;p&gt;
修改/etc/resolv.conf, 包含如下内容，虽然domain与search两者互斥，last one wins，但此处两者均配置。
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;domain abc.com
search abc.com
options rotate timeout:1 attempts:4
nameserver 192.168.1.61
nameserver 192.168.1.62
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline40&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline40&quot;&gt;日常维护&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline40&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline30&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline30&quot;&gt;增加纪录&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline30&quot;&gt;
&lt;p&gt;
例如ftp.abc.com, 对应生产IP 192.168.193.127，办公IP 172.16.2.150
操作步骤如下：
&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline31&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline31&quot;&gt;修改sc.named.abc.com&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline31&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;192.168.193.127    IN    A     ftp
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline32&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline32&quot;&gt;修改oa.named.abc.com&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline32&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;172.16.2.150    IN    A     ftp
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline33&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline33&quot;&gt;修改SERIAL&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline33&quot;&gt;
&lt;p&gt;
zone文件其中有一行标志文件的版本号，添加纪录时，需增加SERIAL的值，此时bind服务器才会认为对此文件做了更新，从而让新zone生效。此处SERIAL的值采用的格式为YYYYMMDDNN，例如2016072001, 表示2016年7月20日的第一次更新，因为计数器的长度只有2^32，所以无法添加小时与分钟，而改用当天修改的次数来表示。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline34&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline34&quot;&gt;查看前后差异&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline34&quot;&gt;
&lt;p&gt;
登录ns00，通过如下命令可查看配置文件与已提交版本差异：
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /root/dns
sh backupdns.sh
git diff --color
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline35&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orgheadline35&quot;&gt;重新加载文件&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orgheadline35&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;rndc reload
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
添加纪录，并递增序列号后，需要通过来重新加载配置。 一般不建议通过重启named服务来重新加载配置。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline36&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline36&quot;&gt;备份&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline36&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;!/bin/&lt;/span&gt;&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;sh&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;LOGFILE&lt;/span&gt;=/var/log/backupdns.log

&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;redirect STDOUT and STDERR to file&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exec&lt;/span&gt; 4&amp;lt;&amp;amp;1
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exec&lt;/span&gt; 5&amp;lt;&amp;amp;2
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exec&lt;/span&gt; 1&amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LOGFILE&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exec&lt;/span&gt; 2&amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LOGFILE&lt;/span&gt;

&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&quot;-------------------------------------------------------------------------&quot;&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; $(date -u) &lt;span style=&quot;color: #800;&quot;&gt;&quot; - start backup dns configuration&quot;&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&quot;-------------------------------------------------------------------------&quot;&lt;/span&gt;

/usr/bin/rsync -avz /var/named/sc.named.abc.com /root/dns/
/usr/bin/rsync -avz /var/named/oa.named.abc.com /root/dns/
/usr/bin/rsync -avz /etc/named.conf /root/dns/master.named.conf
/usr/bin/rsync -avz root@ns01.abc.com:/etc/named.conf /root/dns/slave01.named.conf
/usr/bin/rsync -avz root@ns02.abc.com:/etc/named.conf /root/dns/slave02.named.conf
/usr/bin/rsync -avz /root/dns/ root@ns01.abc.com:/root/dns/
/usr/bin/rsync -avz /root/dns/ root@ns02.abc.com:/root/dns/

&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&quot;-------------------------------------------------------------------------&quot;&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; $(date -u) &lt;span style=&quot;color: #800;&quot;&gt;&quot; - finish backup dns configuration&quot;&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&quot;-------------------------------------------------------------------------&quot;&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exec&lt;/span&gt; 1&amp;lt;&amp;amp;4
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exec&lt;/span&gt; 2&amp;lt;&amp;amp;5
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
通过定时作业运行，除将主要文件备份至本地外，在两台slave服务器上各留存了一份。为了方便后期对历史纪录进行回溯，建议通过如下命令将配置文件加入版本控制
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /root/dns
git init
git add -A .
git status
git commit
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
加入此版本变更说明，比如：
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;serial 2016072001

- type A: 192.168.4.11 =&amp;gt; ntp01
- type A: 192.168.4.12 =&amp;gt; ntp02
- type A: 192.168.193.127 =&amp;gt; ftp.test
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
目前已经提交了一个版本，信息如下：
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;[root@ns00 dns]# git log
commit dc890ae944826d0e060e12b9ca704f92228afc10
Author: wanglifeng_hz &amp;lt;wanglifeng_abc.com&amp;gt;
Date:   Fri Jul 22 09:41:59 2016 +0800

    initial commit

    sc.abc.com:
    ------------------------------------------------------------
    ntp01                       IN      A       192.168.4.11
    ntp02                       IN      A       192.168.4.12
    ftp.test                    IN      A       192.168.193.127

    oa.abc.com
    ------------------------------------------------------------
    ntp01                       IN      A       172.16.2.200
    ftp.test                    IN      A       172.16.2.150
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
后续可以通过&lt;code&gt;git log&lt;/code&gt;命令查看历史变更情况，同时通过&lt;code&gt;checkout&lt;/code&gt;回退至任何版本。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline37&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline37&quot;&gt;监控&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline37&quot;&gt;
&lt;p&gt;
较新版本的bind服务器支持通过http协议暴露出一些DNS服务器的计数器，方便监控与统计分析。访问的网址为&lt;a href=&quot;http://192.168.1.61:8053/&quot;&gt;http://192.168.1.61:8053/&lt;/a&gt; . 当重启DNS服务器时，计数器将被清空。为方便对历史数据进行统计分析，在三台DNS服务器上安装了zabbix-agent，由zabbix-server定期采集数据。具体的报表由grafana dashboard展示，链接地址为：&lt;a href=&quot;http://192.168.11.150:3000/&quot;&gt;http://192.168.11.150:3000/&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline38&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline38&quot;&gt;日志文件&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline38&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;/var/named/data/named.run&lt;/li&gt;
&lt;li&gt;/var/log/message&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline39&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline39&quot;&gt;诊断工具&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline39&quot;&gt;
&lt;p&gt;
可以通过在客户端安装bind-utils包用于DNS服务器的诊断，包含dig, nslookup等命令行工具。
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;dig -t A @192.168.1.61 ntp01.abc.com
dig -t SOA @192.168.1.61 ntp01.abc.com
dig -t NS @192.168.1.61 ntp01.abc.com
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline41&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline41&quot;&gt;ansible自动安装脚本&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline41&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://github.com/wanglf/ansible-playbook/tree/master/roles/bind&quot;&gt;Bind playbook&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline44&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline44&quot;&gt;最佳实践&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline44&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline42&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline42&quot;&gt;最小化重启&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline42&quot;&gt;
&lt;p&gt;
利用&lt;code&gt;rndc reload&lt;/code&gt;单个zone
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline43&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline43&quot;&gt;隐藏primary server&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline43&quot;&gt;
&lt;p&gt;
只有slave server对外提供查询功能，master server只用于配置变更。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline45&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline45&quot;&gt;参考资料&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline45&quot;&gt;
&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;&lt;a href=&quot;http://linux.vbird.org/linux_server/0350dns.php&quot;&gt;鸟哥的私房菜-DNS伺服器&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://shop.oreilly.com/product/9780596100575.do&quot;&gt;DNS and BIND, 5th Edition By Cricket Liu, Paul Albitz.&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sat, 16 Jul 2016 00:00:00 +0800</pubDate>
        <link>/network/bind-dns-server-notes.html</link>
        <guid isPermaLink="true">/network/bind-dns-server-notes.html</guid>
        
        <category>bind</category>
        
        
        <category>network</category>
        
      </item>
    
      <item>
        <title>用ELK来分析Netflow数据</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;说明&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;Cisco路由器配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;logstash配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;排错&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;效果图&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;netflow包格式&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
作为网络运维人员，可随时获取设备上流量分布情况，对容量规划，制定安全措施，均有重要参考意义。ELK技术栈主要的应用场景为日志中心，但本文主要讲述如何利用ELK技术栈分析NETFLOW数据包，实现网络数据流的可视化。Logstash本身带了decoder可直接对netflow UDP数据包进行解析，并index至elasticsearch，随后即可从kibana界面，从不同维度按需对网络数据流进行检索与分析。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;说明&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;p&gt;
本文纪录ELK实现NETFLOW数据包分析的主要步骤，详细的ELK安装与配置步骤请参考官方网站&lt;a href=&quot;https://www.elastic.co/&quot;&gt;www.elastic.co&lt;/a&gt; 。
&lt;/p&gt;

&lt;p&gt;
此方案特色：
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;ElasticSearch后端采用的是Lucene搜索引擎，检索效率非常高。&lt;/li&gt;
&lt;li&gt;可在dashboard的filter中进一步筛选，并实时反映在dashboard效果图。利用这一特性，可以做一通用模板，根据搜索的结果来按需生成效果图。&lt;/li&gt;
&lt;li&gt;ElasticSearch天然具有分布式，冗余的特点，支持非常大规模的部署。理论上支持上千个服务器节点，可以满足不同规模的应用场景。&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;Cisco路由器配置&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
interface GigabitEthernet0/0
 ip flow ingress
interface GigabitEthernet0/1.2
 ip flow ingress
interface GigabitEthernet0/1.3
 ip flow ingress
ip flow-export source Loopback0
ip flow-export version 9
ip flow-export destination 1.1.1.1 2055
&lt;/pre&gt;

&lt;p&gt;
&lt;b&gt;注：此处1.1.1.1为logstash地址，2055为侦听端口&lt;/b&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;logstash配置&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
input {
  udp {
    port =&amp;gt; &quot;2055&quot;
    codec =&amp;gt; netflow {
      versions =&amp;gt; [9]
    }
  }
}

output {
  elasticsearch {
    index =&amp;gt; &quot;netflow-%{+YYYY.MM.DD}&quot;
    hosts =&amp;gt; &quot;localhost:9200&quot;
  }
#  stdout {
#    codec =&amp;gt; rubydebug {
#      metadata =&amp;gt; true
#    }
#  }
} #end output block
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;排错&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;本人测试时发现，若采用netflow version 5，会出现数据不全的情况。&lt;/li&gt;
&lt;li&gt;若elasticsearch未收到数据，可尝试打开rubydebug，观察logstash对netflow包parse结果。&lt;/li&gt;
&lt;li&gt;若logstash未收到包，可尝试运行tcpdump，观察是否已收到路由器送过来的UDP报文。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
tcpdump抓包与保存命令如下，随后可通过wireshark查看截取的数据包。
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;tcpdump -i any -n port 2055 -w netflow.pcap
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline5&quot;&gt;效果图&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;div class=&quot;org-center&quot;&gt;

&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/resource/network/fig/kibana.png&quot; alt=&quot;kibana.png&quot; /&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;netflow包格式&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;div class=&quot;org-center&quot;&gt;

&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/resource/network/fig/tcpdump.png&quot; alt=&quot;tcpdump.png&quot; /&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Tue, 31 May 2016 00:00:00 +0800</pubDate>
        <link>/network/netflow-with-elk.html</link>
        <guid isPermaLink="true">/network/netflow-with-elk.html</guid>
        
        <category>elk</category>
        
        
        <category>network</category>
        
      </item>
    
      <item>
        <title>用Ansible配置思科网络设备</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;环境准备&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;deploy端&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;目标机器&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;ansible playbook&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;hosts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;directory layout&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;site.yml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;tasks/main.yml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;vars/main.yml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;templates/config.j2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
ansible是个什么东西呢？官方的title是“Ansible is Simple IT Automation”——简单的自动化IT工具。这个工具的目标有这么几项：让我们自动化部署APP；自动化管理配置项；自动化的持续交付。Ansible一般通过ssh协议实现linux服务器的管理，但从2.1版本开始，ansible core modules加入了对cisco ios设备的支持，对应的模块为ios_command, ios_config, ios_template。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;环境准备&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline1&quot;&gt;deploy端&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;p&gt;
确认ansible的版本高于2.1
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
ansible --version
ansible 2.2.0 (devel f961f9f4d0) last updated 2016/05/28 09:56:33 (GMT +800)
  lib/ansible/modules/core: (detached HEAD 90e8a36d4c) last updated 2016/05/28 10:23:02 (GMT +800)
  lib/ansible/modules/extras: (detached HEAD 0e4a023a7e) last updated 2016/05/28 10:23:37 (GMT +800)
  config file = /etc/ansible/ansible.cfg
  configured module search path = Default w/o overrides
&lt;/pre&gt;

&lt;p&gt;
如果yum仓库的版本低于2.1，可以通过如下方式从源码安装:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;!/bin/&lt;/span&gt;&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;sh&lt;/span&gt;
&lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;shell script to install ansible from git repo or upgrade&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;count&lt;/span&gt;=$&lt;span style=&quot;color: #007;&quot;&gt;#&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ $&lt;span style=&quot;color: #007;&quot;&gt;count&lt;/span&gt; -ne 1 ]; &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
    &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&quot;usage: setup.sh install|update&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exit&lt;/span&gt; 1
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;param&lt;/span&gt;=$&lt;span style=&quot;color: #007;&quot;&gt;1&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;repodir&lt;/span&gt;=/opt/git
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;repodir&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ $&lt;span style=&quot;color: #007;&quot;&gt;param&lt;/span&gt; == &lt;span style=&quot;color: #800;&quot;&gt;&#39;install&#39;&lt;/span&gt; ]; &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
    git clone git://github.com/ansible/ansible.git --recursive
    &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; ansible
    &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;source&lt;/span&gt; ./hacking/env-setup
    &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exit&lt;/span&gt; 0
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ $&lt;span style=&quot;color: #007;&quot;&gt;param&lt;/span&gt; == &lt;span style=&quot;color: #800;&quot;&gt;&#39;update&#39;&lt;/span&gt; ]; &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
    &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; ansible
    git pull --rebase
    git submodule update --init --recursive
    &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exit&lt;/span&gt; 0
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline2&quot;&gt;目标机器&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
确认思科路由器配置了ssh服务
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
ip domain name xyz.com
crypto key generate rsa modulus 1024
line vty 0 4
  transport input telnet ssh
end
wr
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline10&quot;&gt;ansible playbook&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline4&quot;&gt;hosts&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
[cisco]
r1
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline5&quot;&gt;directory layout&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
find cisco_ios
cisco_ios
cisco_ios/vars
cisco_ios/vars/main.yml
cisco_ios/tasks
cisco_ios/tasks/main.yml
cisco_ios/templates
cisco_ios/templates/config.j2
cisco_ios/site.yml
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline6&quot;&gt;site.yml&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-yaml&quot;&gt;- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: change and show running-config on cisco ios device
  &lt;span style=&quot;color: #007;&quot;&gt;hosts&lt;/span&gt;:
  - cisco
  &lt;span style=&quot;color: #007;&quot;&gt;gather_facts&lt;/span&gt;: &lt;span style=&quot;color: #046; font-weight: bold;&quot;&gt;no&lt;/span&gt;
  &lt;span style=&quot;color: #007;&quot;&gt;connection&lt;/span&gt;: local
  &lt;span style=&quot;color: #007;&quot;&gt;roles&lt;/span&gt;:
  - cisco_ios
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline7&quot;&gt;tasks/main.yml&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-yaml&quot;&gt;
&lt;span style=&quot;color: #633;&quot;&gt;---&lt;/span&gt;
- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: define provider
  &lt;span style=&quot;color: #007;&quot;&gt;set_fact&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;:
      &lt;span style=&quot;color: #007;&quot;&gt;host&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{inventory_hostname}}&quot;&lt;/span&gt;
      &lt;span style=&quot;color: #007;&quot;&gt;username&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{username}}&quot;&lt;/span&gt;
      &lt;span style=&quot;color: #007;&quot;&gt;password&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{password}}&quot;&lt;/span&gt;

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: run show commands with ios_command
  &lt;span style=&quot;color: #007;&quot;&gt;ios_command&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{provider}}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;commands&lt;/span&gt;:
      - show version
      - show ip interface brief
      - show inventory
      - show running | include logging
  &lt;span style=&quot;color: #007;&quot;&gt;register&lt;/span&gt;: show_result

- &lt;span style=&quot;color: #007;&quot;&gt;debug&lt;/span&gt;: var=show_result.stdout_lines

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: change syslog server with ios_config
  &lt;span style=&quot;color: #007;&quot;&gt;ios_config&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{ provider }}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;authorize&lt;/span&gt;: &lt;span style=&quot;color: #046; font-weight: bold;&quot;&gt;yes&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;lines&lt;/span&gt;:
      - logging {{syslogsrv01}}
      - logging {{syslogsrv02}}
    &lt;span style=&quot;color: #007;&quot;&gt;replace&lt;/span&gt;: line
    &lt;span style=&quot;color: #007;&quot;&gt;match&lt;/span&gt;: line
    &lt;span style=&quot;color: #007;&quot;&gt;before&lt;/span&gt;:
      - no logging {{syslogsrv03}}
      - no logging {{syslogsrv04}}
    &lt;span style=&quot;color: #007;&quot;&gt;force&lt;/span&gt;: &lt;span style=&quot;color: #046; font-weight: bold;&quot;&gt;true&lt;/span&gt;

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: run show logging after change with ios_config
  &lt;span style=&quot;color: #007;&quot;&gt;ios_command&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{ provider }}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;commands&lt;/span&gt;:
      - show logging
  &lt;span style=&quot;color: #007;&quot;&gt;register&lt;/span&gt;: after_change_syslog

- &lt;span style=&quot;color: #007;&quot;&gt;debug&lt;/span&gt;: var=after_change_syslog.stdout_lines

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: change syslog server with ios_template
  &lt;span style=&quot;color: #007;&quot;&gt;ios_template&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;host&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{inventory_hostname}}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;username&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{username}}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;password&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{password}}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;src&lt;/span&gt;: config.j2
    &lt;span style=&quot;color: #007;&quot;&gt;force&lt;/span&gt;: &lt;span style=&quot;color: #046; font-weight: bold;&quot;&gt;true&lt;/span&gt;

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: run &lt;span style=&quot;color: #800;&quot;&gt;&quot;show running | include logging&quot;&lt;/span&gt; after change made
  &lt;span style=&quot;color: #007;&quot;&gt;ios_command&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{ provider }}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;commands&lt;/span&gt;:
      - show running | include logging
  &lt;span style=&quot;color: #007;&quot;&gt;register&lt;/span&gt;: syslogsrv_list

- &lt;span style=&quot;color: #007;&quot;&gt;debug&lt;/span&gt;: var=syslogsrv_list.stdout_lines

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: save running-config to startup-config
  &lt;span style=&quot;color: #007;&quot;&gt;ios_command&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{ provider }}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;commands&lt;/span&gt;:
      - write
  &lt;span style=&quot;color: #007;&quot;&gt;register&lt;/span&gt;: write_output

- &lt;span style=&quot;color: #007;&quot;&gt;debug&lt;/span&gt;: var=write_output.stdout_lines

&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline8&quot;&gt;vars/main.yml&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-yaml&quot;&gt;&lt;span style=&quot;color: #007;&quot;&gt;username&lt;/span&gt;: admin
&lt;span style=&quot;color: #007;&quot;&gt;password&lt;/span&gt;: password123
&lt;span style=&quot;color: #007;&quot;&gt;syslogsrv01&lt;/span&gt;: 172.168.10.1
&lt;span style=&quot;color: #007;&quot;&gt;syslogsrv02&lt;/span&gt;: 172.168.10.2
&lt;span style=&quot;color: #007;&quot;&gt;syslogsrv03&lt;/span&gt;: 172.168.10.3
&lt;span style=&quot;color: #007;&quot;&gt;syslogsrv04&lt;/span&gt;: 172.168.10.4
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv01&lt;/span&gt;: 172.168.10.1
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv02&lt;/span&gt;: 172.168.10.2
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv03&lt;/span&gt;: 172.168.10.3
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv04&lt;/span&gt;: 172.168.10.4
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv05&lt;/span&gt;: 172.168.10.5
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv06&lt;/span&gt;: 172.168.10.6
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline9&quot;&gt;templates/config.j2&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;

service tcp-keepalives-in
service tcp-keepalives-out
service timestamps debug datetime localtime
service timestamps log datetime localtime
service password-encryption
logging buffered 512000
clock timezone Beijing 8
no ip source-route
no ip domain lookup
ip domain name xyz.com
no ip http server
no ip http secure-server

!
logging {{syslogsrv01}}
logging {{syslogsrv02}}
!
snmp-server community {{community}} RO
snmp-server ifindex persist
ntp server {{ntpsrv01}}
ntp server {{ntpsrv02}}
no ntp server {{ntpsrv03}}
no ntp server {{ntpsrv04}}
no ntp server {{ntpsrv05}}
no ntp server {{ntpsrv06}}

&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 29 May 2016 00:00:00 +0800</pubDate>
        <link>/network/config-cisco-router-with-ansible.html</link>
        <guid isPermaLink="true">/network/config-cisco-router-with-ansible.html</guid>
        
        <category>ansible</category>
        
        
        <category>network</category>
        
      </item>
    
      <item>
        <title>Solarized Color Scheme Setup</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;iTerm2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;Gnome-terminal&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;Guake&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;vim&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;dircolors-solarized&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;MAC&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;Tmux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;SecureCRT&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;Terminal type&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline13&quot;&gt;Screenshot&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline11&quot;&gt;iTerm2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline12&quot;&gt;dircolor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
solarized是一种非常流行的配色方案，适用于常见的编辑器，如vim, emacs, 及常见仿真终端。本文纪录iterm2, gnome-terminal, guake, SecureCRT, Tmux,  vim编辑器solarized的配置方法。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;iTerm2&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;p&gt;
下载 &lt;a href=&quot;https://github.com/altercation/solarized/tree/master/iterm2-colors-solarized&quot;&gt;iterm2-colors-solarized&lt;/a&gt; ，此处采用dark主题。
&lt;/p&gt;

&lt;p&gt;
Open iTerm2, open Preferences, click on the &quot;Profiles&quot; (formerly Addresses, formerly Bookmarks) icon in the preferences toolbar, then select the &quot;colors&quot; tab. Click on the &quot;load presets&quot; and select &quot;import&amp;#x2026;&quot;. Select the Solarized Light or Dark theme file.
&lt;/p&gt;

&lt;p&gt;
You have now loaded the Solarized color presets into iTerm 2, but haven&#39;t yet applied them. To apply them, simply select an existing profile from the profile list window on the left, or create a new profile. Then select the Solarized Dark or Solarized Light preset from the &quot;Load Presets&quot; drop down.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;Gnome-terminal&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
You need the dconf command (if you run a recent Gnome version).
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;sudo apt-get install dconf-cli
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /opt/git
git clone git@github.com:Anthony25/gnome-terminal-colors-solarized.git
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; gnome-terminal-colors-solarized
./install.sh
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;Guake&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /opt/git
git clone git@github.com:coolwanglu/guake-colors-solarized.git
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; guake-colors-solarized
./set_dark solarized
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;vim&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;p&gt;
in vimrc:
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-vim&quot;&gt;Plugin &#39;altercation/vim-colors-solarized&#39;
set background=dark
colorscheme solarized
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline7&quot;&gt;dircolors-solarized&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline5&quot;&gt;Linux&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /opt/git
git clone git@github.com:seebi/dircolors-solarized.git
cp /opt/git/dircolors-solarized/dircolors.256dark ~/.dircolors.256dark
cat &amp;gt;&amp;gt; ~/.zshrc &amp;lt;&amp;lt; EOF
&lt;span style=&quot;font-weight: bold;&quot;&gt;eval `dircolors ~/.dircolors.256dark`&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;EOF&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline6&quot;&gt;MAC&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /opt/git
git clone git@github.com:seebi/dircolors-solarized.git
cp /opt/git/dircolors-solarized/dircolors.256dark ~/.dircolors.256dark
brew install coreutils
cat &amp;gt;&amp;gt; ~/.zshrc &amp;lt;&amp;lt; EOF
&lt;span style=&quot;font-weight: bold;&quot;&gt;eval `gdircolors ~/.dircolors.256dark`&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;alias ls=&#39;gls --color=auto&#39;&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;EOF&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline8&quot;&gt;Tmux&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
set -g default-terminal &quot;screen-256color&quot;
set -g status-left &quot;#[fg=green]s#S:w#I.p#P#[default]&quot;

#### COLOUR (Solarized dark
# default statusbar colors
set-option -g status-bg black #base02
set-option -g status-fg yellow #yellow
set-option -g status-attr default

# default window title colors
set-window-option -g window-status-fg brightblue #base0
set-window-option -g window-status-bg default
#set-window-option -g window-status-attr dim

# active window title colors
set-window-option -g window-status-current-fg brightred #orange
set-window-option -g window-status-current-bg default
#set-window-option -g window-status-current-attr bright

# pane border
set-option -g pane-border-fg black #base02
set-option -g pane-active-border-fg brightgreen #base01

# message text
set-option -g message-bg black #base02
set-option -g message-fg brightred #orange

# pane number display
set-option -g display-panes-active-colour blue #blue
set-option -g display-panes-colour brightred #orange

# clock
set-window-option -g clock-mode-colour green #green
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline9&quot;&gt;SecureCRT&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/wanglf/dotfiles/master/securecrt/Global.ini&quot;&gt;Global.ini&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/wanglf/dotfiles/master/securecrt/Color%20Schemes.ini&quot;&gt;Color Schemes.ini&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline10&quot;&gt;Terminal type&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #007;&quot;&gt;TERM&lt;/span&gt;=xterm-256color        &lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;for common 256 color terminals (e.g. gnome-terminal)&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #007;&quot;&gt;TERM&lt;/span&gt;=screen-256color       &lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;for a tmux -2 session (also for screen)&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #007;&quot;&gt;TERM&lt;/span&gt;=rxvt-unicode-256color &lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;for a colorful rxvt unicode session&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline13&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline13&quot;&gt;Screenshot&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline13&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline11&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline11&quot;&gt;iTerm2&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline11&quot;&gt;
&lt;div class=&quot;org-center&quot;&gt;

&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/resource/sysadmin/fig/iterm2_solarized.png&quot; alt=&quot;iterm2_solarized.png&quot; /&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline12&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline12&quot;&gt;dircolor&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline12&quot;&gt;
&lt;div class=&quot;org-center&quot;&gt;

&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/resource/sysadmin/fig/dircolor_solarized.png&quot; alt=&quot;dircolor_solarized.png&quot; /&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Fri, 29 Apr 2016 00:00:00 +0800</pubDate>
        <link>/sysadmin/solarized-color-scheme.html</link>
        <guid isPermaLink="true">/sysadmin/solarized-color-scheme.html</guid>
        
        <category>solarized</category>
        
        
        <category>sysadmin</category>
        
      </item>
    
      <item>
        <title>软件随想录卷2-书摘</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;为什么做一个内部程序员就糟透了&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;指针与递归&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;赢家通吃&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;程序员的生产效率&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;关于软件创业&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;五个为什么&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;给计算机系学生的建议&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
Joel Spolsky是世界上最有影响力的程序员之一，被誉为“程序员部落酋长”，开设的个人博客&quot;joel on software&quot;(www.joelonsoftware.com)深受全世界程序员的欢迎。2000年与人联合创办Fog Creek软件公司并经营至今；2008年创办全球最大软件技术问答服务网站stackoverflow并任CEO；2011年被创业孵化器TechStarts聘为创业导师。《软件随想录》收录的是Joel发表在网志上的一部分文章。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;为什么做一个内部程序员就糟透了&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;你永远无法用正确的方法做事，你总是被迫用最保险的方法做事&lt;/li&gt;
&lt;li&gt;一旦你的程序可以用了，你就不得不停止开发。只要核心功能具备了，主要问题解决了，再投资没有商业理由&lt;/li&gt;
&lt;li&gt;如果你在专业的软件公司或互联网公司中编程，你的工作与公司的主营业务直接相关，是能够为公司直接带来收入的。这至少意味着管理层会想到你。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
内部使用的软件很少需要雇用巨星来开发。这就是为什么最令人满意的职业生涯(如果你是程序员)往往是在真正的软件公司里，而不是在银行里担任IT人员。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;指针与递归&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
大学计算机系的课程里有两个传统的知识点，但许多人从来没有真正搞懂过，那就是指针(pointer)和递归(recursion)。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;赢家通吃&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;p&gt;
眼下的软件市场有点&quot;赢家通吃&quot;(winner-take-all)的味道。除了苹果公司，没有其他人能在MP3播放器市场赚到钱。除了微软公司，没有其他人能在电子表格和文字处理器市场上赚到钱。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;程序员的生产效率&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;p&gt;
最好的工作条件 -&amp;gt; 最好的程序员 -&amp;gt; 最好的软件 -&amp;gt; 利润
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline5&quot;&gt;关于软件创业&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;如果你说不清楚你的软件解决了什么*棘手*的问题，就不要去开软件公司。&lt;/li&gt;
&lt;li&gt;不要独自一人创办公司&lt;/li&gt;
&lt;li&gt;一开始不要抱太高期望&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;五个为什么&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;p&gt;
我们机房的连接中断了
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;为什么? 我们交换机里的网线接口好像不工作了&lt;/li&gt;
&lt;li&gt;为什么? 与网络运营中心交换意见后，我们判断这个问题很可能是由于网速/双工模式不匹配造成的。&lt;/li&gt;
&lt;li&gt;为什么? 交换机网口被设置成自动协商，而没有手动设置在一个固定档。&lt;/li&gt;
&lt;li&gt;为什么? 许多年前，我们就清楚地知道有可能发生此类故障。但是，我们始终没有写出一份书面的技术说明文档，用于指导和检查交换机在生产环境中的配置。&lt;/li&gt;
&lt;li&gt;为什么？我们总是很狭隘地看待技术说明文档，觉得只有在找不到系统管理员的情况下才需要去看它，或者觉得只有运营团队中那些不负责系统管理的成员才需要去看它。我们没有认识到应该把它作为技术操作的标准和确认清单。&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline7&quot;&gt;给计算机系学生的建议&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;毕业前练好写作&lt;/li&gt;
&lt;li&gt;毕业前学好C语言&lt;/li&gt;
&lt;li&gt;毕业前学好微观经济学&lt;/li&gt;
&lt;li&gt;不要因为枯燥就不选修非计算机专业的课程&lt;/li&gt;
&lt;li&gt;选修带有大量编程实践的课程&lt;/li&gt;
&lt;li&gt;别担心所有工作都被印度人抢走&lt;/li&gt;
&lt;li&gt;找一份好的时期实习工作&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 03 Apr 2016 00:00:00 +0800</pubDate>
        <link>/books/more-joel-on-software.html</link>
        <guid isPermaLink="true">/books/more-joel-on-software.html</guid>
        
        <category>books</category>
        
        
        <category>books</category>
        
      </item>
    
      <item>
        <title>Freeradius ntlm_auth with microsoft active directory</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;安装服务&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;配置samba与winbind&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;/etc/samba/smb.conf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;/etc/krb5.conf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;/etc/nsswitch.conf&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;启用服务&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;测试&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;Freeradius配置&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;/etc/raddb/mods-enabled/ntlm_auth&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;测试&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
Freeradius是一款开源的AAA认证服务器, 本文总结Freeradius如何通过NTLM_AUTH接口将微软AD用户作为AAA认证用户数据库。本案例在CentOS 7环境下测试通过。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;安装服务&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
yum -y install samba samba-client samba-winbind krb5-server
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline5&quot;&gt;配置samba与winbind&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline2&quot;&gt;/etc/samba/smb.conf&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
[global]
    workgroup = OA
    security = ads
    winbind use default domain = no
    passdb backend = tdbsam
    password server = 1.1.1.1
    realm = OA.ABC.COM
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline3&quot;&gt;/etc/krb5.conf&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
[logging]
  default = FILE:/var/log/krb5libs.log
  kdc = FILE:/var/log/krb5kdc.log
  admin_server = FILE:/var/log/kadmind.log

[libdefaults]
  dns_lookup_realm = false
  ticket_lifetime = 24h
  renew_lifetime = 7d
  forwardable = true
  rdns = false
  default_realm = oa.abc.com
  #default_ccache_name = KEYRING:persistent:%{uid}

[realms]
  oa.abc.com = {
    kdc = 1.1.1.1:88
    admin_server = 1.1.1.1:749
  }

[domain_realm]
  .oa.abc.com = oa.abc.com
  oa.abc.com = oa.abc.com

[kdc]
 profile = /var/kerberos/krb5kdc/kdc.conf
[appdefaults]
  pam = {
    debug = false
    ticket_lifetime = 36000
    renew_lifetime = 36000
    forwardable = true
    krb4_convert = false
  }
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline4&quot;&gt;/etc/nsswitch.conf&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
passwd:     files sss winbind
shadow:     files sss winbind
group:      files sss winbind
protocols:  files winbind
services:   files sss winbind
netgroup:   files sss winbind
automount:  files winbind
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;启用服务&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;systemctl enable smb
systemctl enable winbind
systemctl start smb
systemctl start winbind
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline7&quot;&gt;测试&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;ntlm_auth --request-nt-key --domain=OA --username=wesley
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;
正常情况返回NT_STATUS_OK : Success (0x0)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline10&quot;&gt;Freeradius配置&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline8&quot;&gt;/etc/raddb/mods-enabled/ntlm_auth&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
exec ntlm_auth {
    wait = yes
    program = &quot;/usr/bin/ntlm_auth --request-nt-key --domain=OA.ABC.COM --username=%{mschap:User-Name} --password=%{User-Password}&quot;
}
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline9&quot;&gt;测试&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;radtest -t mschap -x -4 wesley 123456 localhost 10 testing123 0 127.0.0.1
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 03 Apr 2016 00:00:00 +0800</pubDate>
        <link>/network/freeradius-with-ad-ntlmauth.html</link>
        <guid isPermaLink="true">/network/freeradius-with-ad-ntlmauth.html</guid>
        
        <category>freeradius</category>
        
        
        <category>network</category>
        
      </item>
    
      <item>
        <title>Centos bonding基础上设置vlan与bridge</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;关闭NetworkManager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;加载bonding模块&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;配置bond接口&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;物理接口&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;nic01&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;nic02&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;bond子接口&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;bond0.905&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;bond0.906&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline12&quot;&gt;bridge接口&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;brnet06&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline11&quot;&gt;brnet11&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
为了提升系统可用性，一般会利用linux自带的bonding技术实现双网卡绑定。在虚拟机环境下，有时为了提高机器的使用效率，还需要在同一台机器配置不同的网段，这时可以通过vlan技术实现。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;关闭NetworkManager&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;service NetworkManager stop
chkconfig --level 2345 NetworkManager off
chkconfig --level 2345 network on
service network start
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;加载bonding模块&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;cat &amp;gt; /etc/modprobe.d/bonding.conf &amp;lt;&amp;lt; EOF
&lt;span style=&quot;font-weight: bold;&quot;&gt;alias bond0 bonding&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;EOF&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;配置bond接口&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;cat &amp;gt; /etc/sysconfig/network-scripts/ifcfg-bond0 &amp;lt;&amp;lt; EOF
&lt;span style=&quot;font-weight: bold;&quot;&gt;DEVICE=bond0&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;NAME=bond0&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;TYPE=bond&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;BONDING_MASTER=yes&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;BONDING_OPTS=&quot;mode=1 miimon=100&quot;&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;IPV6INIT=no&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;BOOTPROTO=none&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;ONBOOT=yes&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;MTU=9000&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;EOF&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;物理接口&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline4&quot;&gt;nic01&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=ens2f0
NAME=ens2f0
TYPE=Ethernet
BOOTPROTO=none
ONBOOT=yes
MASTER=bond0
SLAVE=yes
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline5&quot;&gt;nic02&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=ens2f1
NAME=ens2f1
TYPE=Ethernet
BOOTPROTO=none
ONBOOT=yes
MASTER=bond0
SLAVE=yes
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline9&quot;&gt;bond子接口&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline7&quot;&gt;bond0.905&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=bond0.905
VLAN=yes
IPV6INIT=no
BOOTPROTO=none
ONBOOT=yes
BRIDGE=brnet11
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline8&quot;&gt;bond0.906&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=bond0.906
VLAN=yes
IPV6INIT=no
BOOTPROTO=none
ONBOOT=yes
BRIDGE=brnet06
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline12&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline12&quot;&gt;bridge接口&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline12&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline10&quot;&gt;brnet06&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=brnet06
BOOTPROTO=none
ONBOOT=yes
TYPE=Bridge
IPADDR=192.168.6.151
NETMASK=255.255.255.0
GATEWAY=192.168.6.254
IPV6INIT=no
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline11&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline11&quot;&gt;brnet11&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline11&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=brnet11
BOOTPROTO=none
ONBOOT=yes
TYPE=Bridge
IPV6INIT=no
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 17 Jan 2016 00:00:00 +0800</pubDate>
        <link>/linux/bonding-vlan-bridge.html</link>
        <guid isPermaLink="true">/linux/bonding-vlan-bridge.html</guid>
        
        <category>bond</category>
        
        <category>networking</category>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>ubuntu14.04安装Atheros QCA61x4无线网卡驱动</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;安装backports&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;下载并编译backports包&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;patch源代码&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;编译&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;安装配置ath10k firmware&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;测试&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
本文联想K20-80安装完ubuntu，发现无法自动识别无线网卡驱动。经查这是ubuntu的bug，影响到联想多款笔记本电脑，链接: &lt;a href=&quot;https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1436940&quot;&gt;Atheros wifi 168c:0041(QCA6164) is not supported&lt;/a&gt; 。本文纪录按#34楼建议解决问题的步骤，供以后查阅。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;安装backports&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline1&quot;&gt;下载并编译backports包&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;wget https://www.kernel.org/pub/linux/kernel/projects/backports/2015/07/31/backports-20150731.tar.gz
tar xvf backports-20150731.tar.gz
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; backports-20150731
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline2&quot;&gt;patch源代码&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
Patch the code with &lt;a href=&quot;https://github.com/atondwal/linux/commit/22f8a4083883eca3e8a3175315d67d2a04392466&quot;&gt;https://github.com/atondwal/linux/commit/22f8a4083883eca3e8a3175315d67d2a04392466&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline3&quot;&gt;编译&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;make defconfig-ath10k
make
sudo make install
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline5&quot;&gt;安装配置ath10k firmware&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;p&gt;
get the latest firmware from &lt;a href=&quot;https://github.com/kvalo/ath10k-firmware/archive/master.zip&quot;&gt;https://github.com/kvalo/ath10k-firmware/archive/master.zip&lt;/a&gt;
Unzip and copy ath10k folder to /lib/firmware/ath10k
&lt;/p&gt;

&lt;p&gt;
Copy these two files (overwrite what you got before) in /lib/firmware/ath10k/QCA6164/hw2.1:
&lt;a href=&quot;https://github.com/atondwal/ath10k-firmware/tree/master/ath10k/QCA6164/hw2.1&quot;&gt;https://github.com/atondwal/ath10k-firmware/tree/master/ath10k/QCA6164/hw2.1&lt;/a&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;rm -rf /lib/firmware/ath10k/QCA6174/hw3.0/
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
Create a file named /etc/modprobe.d/ath10k.conf with the following line:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
options ath10k_core skip_otp=y
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;测试&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;p&gt;
Reboot and modprobe ath10k_pci. Do &quot;lshw -C network&quot;; &quot;ip link show&quot; or &quot;rfkill list&quot; to see if you got your card working.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 03 Jan 2016 00:00:00 +0800</pubDate>
        <link>/linux/install-ath10k-wireless-driver-on-ubuntu.html</link>
        <guid isPermaLink="true">/linux/install-ath10k-wireless-driver-on-ubuntu.html</guid>
        
        <category>driver</category>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>持续集成工具之jenkins</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;jenkins安装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;插件安装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;配置环境&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;新建Job&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;SCM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;Build Triggers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;Configure Maven&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;Post Steps&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline11&quot;&gt;备机安装与数据同步&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;同步脚本&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;定期执行&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline12&quot;&gt;附录: Maven通过nexus下载构建的配置文件&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
本文介绍使用jenkins实现持续集成。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;jenkins安装&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;p&gt;
官方提供的是一个war包，可以直接放在tomcat容器中运行。jenkins不需要任何后台数据库支持，所有的变更纪录均放置在JENKINS_HOME，默认为~/.jenkins。
&lt;/p&gt;

&lt;p&gt;
单独运行jenkins的命令如下:
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
java -jar jenkins.war --httpPort=8081
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;插件安装&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
选择Manage Jenkins -&amp;gt; Manage Plugins进行插件的安装。如果CI服务器本身需要代理才能连接互联网，可以在Advanced中进行设置。常用的插件有Github Plugins，安装此插件同时会安装所依赖插件。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;配置环境&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;p&gt;
Manage Jenkins -&amp;gt; Configure System 此处设置JDK的HOME目录，Maven的目录, git可执行文件路径等。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;新建Job&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;p&gt;
输入Job的名称，此处以从git仓库clone Maven项目作为示例。
&lt;/p&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline5&quot;&gt;SCM&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;Source Code Management 选择git&lt;/li&gt;
&lt;li&gt;Repository URL: ssh://admin@gerrit:29418/reponame&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline6&quot;&gt;Build Triggers&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;Build when a change is pushed to GitHub (代码更新时build)&lt;/li&gt;
&lt;li&gt;Poll SCM (周期性从repo中checkout)&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&quot;example&quot;&gt;
*/10 * * * *
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline7&quot;&gt;Configure Maven&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;Root POM : pom.xml&lt;/li&gt;
&lt;li&gt;Goals and options: clean install&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline8&quot;&gt;Post Steps&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;p&gt;
Execute shell
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;!/bin/&lt;/span&gt;&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;sh&lt;/span&gt;
&lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;copy built file to remote http server&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;project&lt;/span&gt;=easy-springmvc-maven
&lt;span style=&quot;color: #007;&quot;&gt;war_name&lt;/span&gt;=${&lt;span style=&quot;color: #007;&quot;&gt;project&lt;/span&gt;}.war
&lt;span style=&quot;color: #007;&quot;&gt;file_path&lt;/span&gt;=/root/.jenkins/jobs/${&lt;span style=&quot;color: #007;&quot;&gt;project&lt;/span&gt;}/workspace/target
&lt;span style=&quot;color: #007;&quot;&gt;now&lt;/span&gt;=$(date +&lt;span style=&quot;color: #800;&quot;&gt;&quot;%Y%m%d%H%M%S&quot;&lt;/span&gt;)

&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;file_path&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ -f ${&lt;span style=&quot;color: #007;&quot;&gt;war_name&lt;/span&gt;} ]; &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
scp ${&lt;span style=&quot;color: #007;&quot;&gt;war_name&lt;/span&gt;} root@filesrv01:/usr/share/nginx/html/files/dist/${&lt;span style=&quot;color: #007;&quot;&gt;project&lt;/span&gt;}-${&lt;span style=&quot;color: #007;&quot;&gt;now&lt;/span&gt;}.war
cp ${&lt;span style=&quot;color: #007;&quot;&gt;war_name&lt;/span&gt;} /opt/tomcat/webapps/${&lt;span style=&quot;color: #007;&quot;&gt;project&lt;/span&gt;}-${&lt;span style=&quot;color: #007;&quot;&gt;now&lt;/span&gt;}.war
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;else&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&quot;${war_name} unexists&quot;&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-orgheadline11&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline11&quot;&gt;备机安装与数据同步&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline11&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline9&quot;&gt;同步脚本&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;p&gt;
备机的安装方法与主机相同，数据通过如下脚本同步:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;!/bin/&lt;/span&gt;&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;sh&lt;/span&gt;
&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;script name:rsyncjenkins.sh&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&quot;/usr/bin/rsync&quot;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;-avz -e ssh --delete --bwlimit=8000&#39;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;/root/.jenkins&#39;&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;/var/log/rsyncjenkins&#39;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;=&lt;span style=&quot;font-weight: bold;&quot;&gt;`date +%Y-%m-%d`&lt;/span&gt;

&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;check function&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;check&lt;/span&gt; {
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ $&lt;span style=&quot;color: #007;&quot;&gt;?&lt;/span&gt; -eq 0 ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; -e &lt;span style=&quot;color: #800;&quot;&gt;&quot;33[1;32mRsync is success!33[0m&quot;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;else&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; -e &lt;span style=&quot;color: #800;&quot;&gt;&quot;33[1;31mRsync is fail!33[0m&quot;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;
}

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt; -d &lt;span style=&quot;color: #800;&quot;&gt;&quot;$jenkins_dir&quot;&lt;/span&gt; ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
mkdir -pv $&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt; -d &lt;span style=&quot;color: #800;&quot;&gt;&quot;$LogFileDir&quot;&lt;/span&gt; ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
mkdir -pv $&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&#39;Now start to rsync jenkins home directory!&#39;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt; root@tomcat01:$&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/jobs/ $&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/jobs/ &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt; root@tomcat01:$&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/plugins/ $&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/plugins/ &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt; root@tomcat01:$&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/*.xml $&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/ &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
check&lt;span style=&quot;color: #800;&quot;&gt;&quot;]]&quot;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline10&quot;&gt;定期执行&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
00 00 * * * /bin/sh /root/sh/rsyncjenkins.sh &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
&lt;/pre&gt;

&lt;p&gt;
&lt;code&gt;备机需要重启容器才能加载新的配置。&lt;/code&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline12&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline12&quot;&gt;附录: Maven通过nexus下载构建的配置文件&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline12&quot;&gt;
&lt;p&gt;
cat ~/.m2/settings.xml
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-xml&quot;&gt;  &amp;lt;?&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;xml&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
  &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;settings&lt;/span&gt; &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;xmlns&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;http://maven.apache.org/SETTINGS/1.0.0&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;
            &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;xmlns&lt;/span&gt;:&lt;span style=&quot;color: #007;&quot;&gt;xsi&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;http://www.w3.org/2001/XMLSchema-instance&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;
            &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;xsi&lt;/span&gt;:&lt;span style=&quot;color: #007;&quot;&gt;schemaLocation&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirrors&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirror&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;nexus&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirrorOf&lt;/span&gt;&amp;gt;*&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirrorOf&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;name&lt;/span&gt;&amp;gt;Nexus Public Mirror&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;name&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;http://nexusip:8081/nexus/content/groups/public&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;
      &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirror&lt;/span&gt;&amp;gt;
    &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirrors&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;profiles&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;profile&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;nexus&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;repositories&lt;/span&gt;&amp;gt;
          &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;repository&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;central&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;http://central&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;releases&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;true&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;releases&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;snapshots&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;true&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;snapshots&lt;/span&gt;&amp;gt;
          &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;repository&lt;/span&gt;&amp;gt;
        &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;repositories&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;pluginRepositories&lt;/span&gt;&amp;gt;
          &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;pluginRepository&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;central&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;http://central&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;releases&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;true&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;releases&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;snapshots&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;true&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;snapshots&lt;/span&gt;&amp;gt;
          &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;pluginRepository&lt;/span&gt;&amp;gt;
        &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;pluginRepositories&lt;/span&gt;&amp;gt;
      &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;profile&lt;/span&gt;&amp;gt;
    &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;profiles&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;activeProfiles&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;activeProfile&lt;/span&gt;&amp;gt;nexus&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;activeProfile&lt;/span&gt;&amp;gt;
    &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;activeProfiles&lt;/span&gt;&amp;gt;
  &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;settings&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
主要配置mirror，因为*可通配所有路径，此时profile中的url已经没意义，所有的构建将全部通过mirror指定的链接，即nexus中的public repository group去下载。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 06 Dec 2015 00:00:00 +0800</pubDate>
        <link>/tools/jenkins-ci-setup.html</link>
        <guid isPermaLink="true">/tools/jenkins-ci-setup.html</guid>
        
        <category>jenkins</category>
        
        
        <category>tools</category>
        
      </item>
    
  </channel>
</rss>
