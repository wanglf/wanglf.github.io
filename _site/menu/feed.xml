<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>田园牧歌</title>
    <description>Wonder is the beginning of wisdom</description>
    <link>/</link>
    <atom:link href="/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Tue, 31 May 2016 14:04:42 +0800</pubDate>
    <lastBuildDate>Tue, 31 May 2016 14:04:42 +0800</lastBuildDate>
    <generator>Jekyll v2.5.3</generator>
    
      <item>
        <title>用ELK来分析Netflow数据</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;说明&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;Cisco路由器配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;logstash配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;排错&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;效果图&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;netflow包格式&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
作为网络运维人员，可随时获取设备上流量分布情况，对容量规划，制定安全措施，均有重要参考意义。ELK技术栈主要的应用场景为日志中心，但本文主要讲述如何利用ELK技术栈分析NETFLOW数据包，实现网络数据流的可视化。Logstash本身带了decoder可直接对netflow UDP数据包进行解析，并index至elasticsearch，随后即可从kibana界面，从不同维度按需对网络数据流进行检索与分析。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;说明&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;p&gt;
本文纪录ELK实现NETFLOW数据包分析的主要步骤，详细的ELK安装与配置步骤请参考官方网站&lt;a href=&quot;https://www.elastic.co/&quot;&gt;www.elastic.co&lt;/a&gt; 。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;Cisco路由器配置&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
interface GigabitEthernet0/0
 ip flow ingress
interface GigabitEthernet0/1.2
 ip flow ingress
interface GigabitEthernet0/1.3
 ip flow ingress
ip flow-export source Loopback0
ip flow-export version 9
ip flow-export destination 1.1.1.1 2055
&lt;/pre&gt;

&lt;p&gt;
&lt;b&gt;注：此处1.1.1.1为logstash地址，2055为侦听端口&lt;/b&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;logstash配置&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
input {
  udp {
    port =&amp;gt; &quot;2055&quot;
    codec =&amp;gt; netflow {
      versions =&amp;gt; [9]
    }
  }
}

output {
  elasticsearch {
    index =&amp;gt; &quot;netflow-%{+YYYY.MM.DD}&quot;
    hosts =&amp;gt; &quot;localhost:9200&quot;
  }
#  stdout {
#    codec =&amp;gt; rubydebug {
#      metadata =&amp;gt; true
#    }
#  }
} #end output block
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;排错&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;本人测试时发现，若采用netflow version 5，会出现数据不全的情况。&lt;/li&gt;
&lt;li&gt;若elasticsearch未收到数据，可尝试打开rubydebug，观察logstash对netflow包parse结果。&lt;/li&gt;
&lt;li&gt;若logstash未收到包，可尝试运行tcpdump，观察是否已收到路由器送过来的UDP报文。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
tcpdump抓包与保存命令如下，随后可通过wireshark查看截取的数据包。
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;tcpdump -i any -n port 2055 -w netflow.pcap
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline5&quot;&gt;效果图&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;div class=&quot;org-center&quot;&gt;

&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/resource/network/fig/kibana.png&quot; alt=&quot;kibana.png&quot; /&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;netflow包格式&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;div class=&quot;org-center&quot;&gt;

&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/resource/network/fig/tcpdump.png&quot; alt=&quot;tcpdump.png&quot; /&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Tue, 31 May 2016 00:00:00 +0800</pubDate>
        <link>/network/netflow-with-elk.html</link>
        <guid isPermaLink="true">/network/netflow-with-elk.html</guid>
        
        <category>elk</category>
        
        
        <category>network</category>
        
      </item>
    
      <item>
        <title>用Ansible配置思科网络设备</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;环境准备&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;deploy端&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;目标机器&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;ansible playbook&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;hosts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;directory layout&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;site.yml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;tasks/main.yml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;vars/main.yml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;templates/config.j2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
ansible是个什么东西呢？官方的title是“Ansible is Simple IT Automation”——简单的自动化IT工具。这个工具的目标有这么几项：让我们自动化部署APP；自动化管理配置项；自动化的持续交付。Ansible一般通过ssh协议实现linux服务器的管理，但从2.1版本开始，ansible core modules加入了对cisco ios设备的支持，对应的模块为ios_command, ios_config, ios_template。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;环境准备&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline1&quot;&gt;deploy端&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;p&gt;
确认ansible的版本高于2.1
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
ansible --version
ansible 2.2.0 (devel f961f9f4d0) last updated 2016/05/28 09:56:33 (GMT +800)
  lib/ansible/modules/core: (detached HEAD 90e8a36d4c) last updated 2016/05/28 10:23:02 (GMT +800)
  lib/ansible/modules/extras: (detached HEAD 0e4a023a7e) last updated 2016/05/28 10:23:37 (GMT +800)
  config file = /etc/ansible/ansible.cfg
  configured module search path = Default w/o overrides
&lt;/pre&gt;

&lt;p&gt;
如果yum仓库的版本低于2.1，可以通过如下方式从源码安装:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;!/bin/&lt;/span&gt;&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;sh&lt;/span&gt;
&lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;shell script to install ansible from git repo or upgrade&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;count&lt;/span&gt;=$&lt;span style=&quot;color: #007;&quot;&gt;#&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ $&lt;span style=&quot;color: #007;&quot;&gt;count&lt;/span&gt; -ne 1 ]; &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
    &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&quot;usage: setup.sh install|update&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exit&lt;/span&gt; 1
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;param&lt;/span&gt;=$&lt;span style=&quot;color: #007;&quot;&gt;1&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;repodir&lt;/span&gt;=/opt/git
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;repodir&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ $&lt;span style=&quot;color: #007;&quot;&gt;param&lt;/span&gt; == &lt;span style=&quot;color: #800;&quot;&gt;&#39;install&#39;&lt;/span&gt; ]; &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
    git clone git://github.com/ansible/ansible.git --recursive
    &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; ansible
    &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;source&lt;/span&gt; ./hacking/env-setup
    &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exit&lt;/span&gt; 0
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ $&lt;span style=&quot;color: #007;&quot;&gt;param&lt;/span&gt; == &lt;span style=&quot;color: #800;&quot;&gt;&#39;update&#39;&lt;/span&gt; ]; &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
    &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; ansible
    git pull --rebase
    git submodule update --init --recursive
    &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;exit&lt;/span&gt; 0
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline2&quot;&gt;目标机器&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
确认思科路由器配置了ssh服务
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
ip domain name xyz.com
crypto key generate rsa modulus 1024
line vty 0 4
  transport input telnet ssh
end
wr
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline10&quot;&gt;ansible playbook&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline4&quot;&gt;hosts&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
[cisco]
r1
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline5&quot;&gt;directory layout&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
find cisco_ios
cisco_ios
cisco_ios/vars
cisco_ios/vars/main.yml
cisco_ios/tasks
cisco_ios/tasks/main.yml
cisco_ios/templates
cisco_ios/templates/config.j2
cisco_ios/site.yml
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline6&quot;&gt;site.yml&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-yaml&quot;&gt;- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: change and show running-config on cisco ios device
  &lt;span style=&quot;color: #007;&quot;&gt;hosts&lt;/span&gt;:
  - cisco
  &lt;span style=&quot;color: #007;&quot;&gt;gather_facts&lt;/span&gt;: &lt;span style=&quot;color: #046; font-weight: bold;&quot;&gt;no&lt;/span&gt;
  &lt;span style=&quot;color: #007;&quot;&gt;connection&lt;/span&gt;: local
  &lt;span style=&quot;color: #007;&quot;&gt;roles&lt;/span&gt;:
  - cisco_ios
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline7&quot;&gt;tasks/main.yml&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-yaml&quot;&gt;
&lt;span style=&quot;color: #633;&quot;&gt;---&lt;/span&gt;
- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: define provider
  &lt;span style=&quot;color: #007;&quot;&gt;set_fact&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;:
      &lt;span style=&quot;color: #007;&quot;&gt;host&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{inventory_hostname}}&quot;&lt;/span&gt;
      &lt;span style=&quot;color: #007;&quot;&gt;username&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{username}}&quot;&lt;/span&gt;
      &lt;span style=&quot;color: #007;&quot;&gt;password&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{password}}&quot;&lt;/span&gt;

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: run show commands with ios_command
  &lt;span style=&quot;color: #007;&quot;&gt;ios_command&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{provider}}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;commands&lt;/span&gt;:
      - show version
      - show ip interface brief
      - show inventory
      - show running | include logging
  &lt;span style=&quot;color: #007;&quot;&gt;register&lt;/span&gt;: show_result

- &lt;span style=&quot;color: #007;&quot;&gt;debug&lt;/span&gt;: var=show_result.stdout_lines

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: change syslog server with ios_config
  &lt;span style=&quot;color: #007;&quot;&gt;ios_config&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{ provider }}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;authorize&lt;/span&gt;: &lt;span style=&quot;color: #046; font-weight: bold;&quot;&gt;yes&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;lines&lt;/span&gt;:
      - logging {{syslogsrv01}}
      - logging {{syslogsrv02}}
    &lt;span style=&quot;color: #007;&quot;&gt;replace&lt;/span&gt;: line
    &lt;span style=&quot;color: #007;&quot;&gt;match&lt;/span&gt;: line
    &lt;span style=&quot;color: #007;&quot;&gt;before&lt;/span&gt;:
      - no logging {{syslogsrv03}}
      - no logging {{syslogsrv04}}
    &lt;span style=&quot;color: #007;&quot;&gt;force&lt;/span&gt;: &lt;span style=&quot;color: #046; font-weight: bold;&quot;&gt;true&lt;/span&gt;

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: run show logging after change with ios_config
  &lt;span style=&quot;color: #007;&quot;&gt;ios_command&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{ provider }}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;commands&lt;/span&gt;:
      - show logging
  &lt;span style=&quot;color: #007;&quot;&gt;register&lt;/span&gt;: after_change_syslog

- &lt;span style=&quot;color: #007;&quot;&gt;debug&lt;/span&gt;: var=after_change_syslog.stdout_lines

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: change syslog server with ios_template
  &lt;span style=&quot;color: #007;&quot;&gt;ios_template&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;host&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{inventory_hostname}}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;username&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{username}}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;password&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{password}}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;src&lt;/span&gt;: config.j2
    &lt;span style=&quot;color: #007;&quot;&gt;force&lt;/span&gt;: &lt;span style=&quot;color: #046; font-weight: bold;&quot;&gt;true&lt;/span&gt;

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: run &lt;span style=&quot;color: #800;&quot;&gt;&quot;show running | include logging&quot;&lt;/span&gt; after change made
  &lt;span style=&quot;color: #007;&quot;&gt;ios_command&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{ provider }}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;commands&lt;/span&gt;:
      - show running | include logging
  &lt;span style=&quot;color: #007;&quot;&gt;register&lt;/span&gt;: syslogsrv_list

- &lt;span style=&quot;color: #007;&quot;&gt;debug&lt;/span&gt;: var=syslogsrv_list.stdout_lines

- &lt;span style=&quot;color: #007;&quot;&gt;name&lt;/span&gt;: save running-config to startup-config
  &lt;span style=&quot;color: #007;&quot;&gt;ios_command&lt;/span&gt;:
    &lt;span style=&quot;color: #007;&quot;&gt;provider&lt;/span&gt;: &lt;span style=&quot;color: #800;&quot;&gt;&quot;{{ provider }}&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #007;&quot;&gt;commands&lt;/span&gt;:
      - write
  &lt;span style=&quot;color: #007;&quot;&gt;register&lt;/span&gt;: write_output

- &lt;span style=&quot;color: #007;&quot;&gt;debug&lt;/span&gt;: var=write_output.stdout_lines

&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline8&quot;&gt;vars/main.yml&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-yaml&quot;&gt;&lt;span style=&quot;color: #007;&quot;&gt;username&lt;/span&gt;: admin
&lt;span style=&quot;color: #007;&quot;&gt;password&lt;/span&gt;: password123
&lt;span style=&quot;color: #007;&quot;&gt;syslogsrv01&lt;/span&gt;: 172.168.10.1
&lt;span style=&quot;color: #007;&quot;&gt;syslogsrv02&lt;/span&gt;: 172.168.10.2
&lt;span style=&quot;color: #007;&quot;&gt;syslogsrv03&lt;/span&gt;: 172.168.10.3
&lt;span style=&quot;color: #007;&quot;&gt;syslogsrv04&lt;/span&gt;: 172.168.10.4
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv01&lt;/span&gt;: 172.168.10.1
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv02&lt;/span&gt;: 172.168.10.2
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv03&lt;/span&gt;: 172.168.10.3
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv04&lt;/span&gt;: 172.168.10.4
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv05&lt;/span&gt;: 172.168.10.5
&lt;span style=&quot;color: #007;&quot;&gt;ntpsrv06&lt;/span&gt;: 172.168.10.6
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline9&quot;&gt;templates/config.j2&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;

service tcp-keepalives-in
service tcp-keepalives-out
service timestamps debug datetime localtime
service timestamps log datetime localtime
service password-encryption
logging buffered 512000
clock timezone Beijing 8
no ip source-route
no ip domain lookup
ip domain name xyz.com
no ip http server
no ip http secure-server

!
logging {{syslogsrv01}}
logging {{syslogsrv02}}
!
snmp-server community {{community}} RO
snmp-server ifindex persist
ntp server {{ntpsrv01}}
ntp server {{ntpsrv02}}
no ntp server {{ntpsrv03}}
no ntp server {{ntpsrv04}}
no ntp server {{ntpsrv05}}
no ntp server {{ntpsrv06}}

&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 29 May 2016 00:00:00 +0800</pubDate>
        <link>/network/config-cisco-router-with-ansible.html</link>
        <guid isPermaLink="true">/network/config-cisco-router-with-ansible.html</guid>
        
        <category>ansible</category>
        
        
        <category>network</category>
        
      </item>
    
      <item>
        <title>Solarized Color Scheme Setup</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;iTerm2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;Gnome-terminal&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;Guake&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;vim&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;dircolors-solarized&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;MAC&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;Tmux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;SecureCRT&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;Terminal type&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline13&quot;&gt;Screenshot&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline11&quot;&gt;iTerm2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline12&quot;&gt;dircolor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
solarized是一种非常流行的配色方案，适用于常见的编辑器，如vim, emacs, 及常见仿真终端。本文纪录iterm2, gnome-terminal, guake, SecureCRT, Tmux,  vim编辑器solarized的配置方法。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;iTerm2&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;p&gt;
下载 &lt;a href=&quot;https://github.com/altercation/solarized/tree/master/iterm2-colors-solarized&quot;&gt;iterm2-colors-solarized&lt;/a&gt; ，此处采用dark主题。
&lt;/p&gt;

&lt;p&gt;
Open iTerm2, open Preferences, click on the &quot;Profiles&quot; (formerly Addresses, formerly Bookmarks) icon in the preferences toolbar, then select the &quot;colors&quot; tab. Click on the &quot;load presets&quot; and select &quot;import&amp;#x2026;&quot;. Select the Solarized Light or Dark theme file.
&lt;/p&gt;

&lt;p&gt;
You have now loaded the Solarized color presets into iTerm 2, but haven&#39;t yet applied them. To apply them, simply select an existing profile from the profile list window on the left, or create a new profile. Then select the Solarized Dark or Solarized Light preset from the &quot;Load Presets&quot; drop down.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;Gnome-terminal&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
You need the dconf command (if you run a recent Gnome version).
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;sudo apt-get install dconf-cli
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /opt/git
git clone git@github.com:Anthony25/gnome-terminal-colors-solarized.git
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; gnome-terminal-colors-solarized
./install.sh
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;Guake&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /opt/git
git clone git@github.com:coolwanglu/guake-colors-solarized.git
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; guake-colors-solarized
./set_dark solarized
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;vim&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;p&gt;
in vimrc:
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-vim&quot;&gt;Plugin &#39;altercation/vim-colors-solarized&#39;
set background=dark
colorscheme solarized
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline7&quot;&gt;dircolors-solarized&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline5&quot;&gt;Linux&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /opt/git
git clone git@github.com:seebi/dircolors-solarized.git
cp /opt/git/dircolors-solarized/dircolors.256dark ~/.dircolors.256dark
cat &amp;gt;&amp;gt; ~/.zshrc &amp;lt;&amp;lt; EOF
&lt;span style=&quot;font-weight: bold;&quot;&gt;eval `dircolors ~/.dircolors.256dark`&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;EOF&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline6&quot;&gt;MAC&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; /opt/git
git clone git@github.com:seebi/dircolors-solarized.git
cp /opt/git/dircolors-solarized/dircolors.256dark ~/.dircolors.256dark
brew install coreutils
cat &amp;gt;&amp;gt; ~/.zshrc &amp;lt;&amp;lt; EOF
&lt;span style=&quot;font-weight: bold;&quot;&gt;eval `gdircolors ~/.dircolors.256dark`&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;alias ls=&#39;gls --color=auto&#39;&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;EOF&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline8&quot;&gt;Tmux&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
set -g default-terminal &quot;screen-256color&quot;
set -g status-left &quot;#[fg=green]s#S:w#I.p#P#[default]&quot;

#### COLOUR (Solarized dark
# default statusbar colors
set-option -g status-bg black #base02
set-option -g status-fg yellow #yellow
set-option -g status-attr default

# default window title colors
set-window-option -g window-status-fg brightblue #base0
set-window-option -g window-status-bg default
#set-window-option -g window-status-attr dim

# active window title colors
set-window-option -g window-status-current-fg brightred #orange
set-window-option -g window-status-current-bg default
#set-window-option -g window-status-current-attr bright

# pane border
set-option -g pane-border-fg black #base02
set-option -g pane-active-border-fg brightgreen #base01

# message text
set-option -g message-bg black #base02
set-option -g message-fg brightred #orange

# pane number display
set-option -g display-panes-active-colour blue #blue
set-option -g display-panes-colour brightred #orange

# clock
set-window-option -g clock-mode-colour green #green
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline9&quot;&gt;SecureCRT&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/wanglf/dotfiles/master/securecrt/Global.ini&quot;&gt;Global.ini&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://raw.githubusercontent.com/wanglf/dotfiles/master/securecrt/Color%20Schemes.ini&quot;&gt;Color Schemes.ini&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline10&quot;&gt;Terminal type&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #007;&quot;&gt;TERM&lt;/span&gt;=xterm-256color        &lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;for common 256 color terminals (e.g. gnome-terminal)&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #007;&quot;&gt;TERM&lt;/span&gt;=screen-256color       &lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;for a tmux -2 session (also for screen)&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #007;&quot;&gt;TERM&lt;/span&gt;=rxvt-unicode-256color &lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;for a colorful rxvt unicode session&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline13&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline13&quot;&gt;Screenshot&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline13&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline11&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline11&quot;&gt;iTerm2&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline11&quot;&gt;
&lt;div class=&quot;org-center&quot;&gt;

&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/resource/sysadmin/fig/iterm2_solarized.png&quot; alt=&quot;iterm2_solarized.png&quot; /&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline12&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline12&quot;&gt;dircolor&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline12&quot;&gt;
&lt;div class=&quot;org-center&quot;&gt;

&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/resource/sysadmin/fig/dircolor_solarized.png&quot; alt=&quot;dircolor_solarized.png&quot; /&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Fri, 29 Apr 2016 00:00:00 +0800</pubDate>
        <link>/sysadmin/solarized-color-scheme.html</link>
        <guid isPermaLink="true">/sysadmin/solarized-color-scheme.html</guid>
        
        <category>solarized</category>
        
        
        <category>sysadmin</category>
        
      </item>
    
      <item>
        <title>软件随想录卷2-书摘</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;为什么做一个内部程序员就糟透了&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;指针与递归&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;赢家通吃&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;程序员的生产效率&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;关于软件创业&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;五个为什么&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;给计算机系学生的建议&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
Joel Spolsky是世界上最有影响力的程序员之一，被誉为“程序员部落酋长”，开设的个人博客&quot;joel on software&quot;(www.joelonsoftware.com)深受全世界程序员的欢迎。2000年与人联合创办Fog Creek软件公司并经营至今；2008年创办全球最大软件技术问答服务网站stackoverflow并任CEO；2011年被创业孵化器TechStarts聘为创业导师。《软件随想录》收录的是Joel发表在网志上的一部分文章。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;为什么做一个内部程序员就糟透了&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;你永远无法用正确的方法做事，你总是被迫用最保险的方法做事&lt;/li&gt;
&lt;li&gt;一旦你的程序可以用了，你就不得不停止开发。只要核心功能具备了，主要问题解决了，再投资没有商业理由&lt;/li&gt;
&lt;li&gt;如果你在专业的软件公司或互联网公司中编程，你的工作与公司的主营业务直接相关，是能够为公司直接带来收入的。这至少意味着管理层会想到你。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
内部使用的软件很少需要雇用巨星来开发。这就是为什么最令人满意的职业生涯(如果你是程序员)往往是在真正的软件公司里，而不是在银行里担任IT人员。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;指针与递归&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
大学计算机系的课程里有两个传统的知识点，但许多人从来没有真正搞懂过，那就是指针(pointer)和递归(recursion)。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;赢家通吃&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;p&gt;
眼下的软件市场有点&quot;赢家通吃&quot;(winner-take-all)的味道。除了苹果公司，没有其他人能在MP3播放器市场赚到钱。除了微软公司，没有其他人能在电子表格和文字处理器市场上赚到钱。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;程序员的生产效率&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;p&gt;
最好的工作条件 -&amp;gt; 最好的程序员 -&amp;gt; 最好的软件 -&amp;gt; 利润
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline5&quot;&gt;关于软件创业&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;如果你说不清楚你的软件解决了什么*棘手*的问题，就不要去开软件公司。&lt;/li&gt;
&lt;li&gt;不要独自一人创办公司&lt;/li&gt;
&lt;li&gt;一开始不要抱太高期望&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;五个为什么&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;p&gt;
我们机房的连接中断了
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;为什么? 我们交换机里的网线接口好像不工作了&lt;/li&gt;
&lt;li&gt;为什么? 与网络运营中心交换意见后，我们判断这个问题很可能是由于网速/双工模式不匹配造成的。&lt;/li&gt;
&lt;li&gt;为什么? 交换机网口被设置成自动协商，而没有手动设置在一个固定档。&lt;/li&gt;
&lt;li&gt;为什么? 许多年前，我们就清楚地知道有可能发生此类故障。但是，我们始终没有写出一份书面的技术说明文档，用于指导和检查交换机在生产环境中的配置。&lt;/li&gt;
&lt;li&gt;为什么？我们总是很狭隘地看待技术说明文档，觉得只有在找不到系统管理员的情况下才需要去看它，或者觉得只有运营团队中那些不负责系统管理的成员才需要去看它。我们没有认识到应该把它作为技术操作的标准和确认清单。&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline7&quot;&gt;给计算机系学生的建议&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;毕业前练好写作&lt;/li&gt;
&lt;li&gt;毕业前学好C语言&lt;/li&gt;
&lt;li&gt;毕业前学好微观经济学&lt;/li&gt;
&lt;li&gt;不要因为枯燥就不选修非计算机专业的课程&lt;/li&gt;
&lt;li&gt;选修带有大量编程实践的课程&lt;/li&gt;
&lt;li&gt;别担心所有工作都被印度人抢走&lt;/li&gt;
&lt;li&gt;找一份好的时期实习工作&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 03 Apr 2016 00:00:00 +0800</pubDate>
        <link>/books/more-joel-on-software.html</link>
        <guid isPermaLink="true">/books/more-joel-on-software.html</guid>
        
        <category>books</category>
        
        
        <category>books</category>
        
      </item>
    
      <item>
        <title>Freeradius ntlm_auth with microsoft active directory</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;安装服务&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;配置samba与winbind&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;/etc/samba/smb.conf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;/etc/krb5.conf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;/etc/nsswitch.conf&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;启用服务&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;测试&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;Freeradius配置&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;/etc/raddb/mods-enabled/ntlm_auth&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;测试&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
Freeradius是一款开源的AAA认证服务器, 本文总结Freeradius如何通过NTLM_AUTH接口将微软AD用户作为AAA认证用户数据库。本案例在CentOS 7环境下测试通过。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;安装服务&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
yum -y install samba samba-client samba-winbind krb5-server
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline5&quot;&gt;配置samba与winbind&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline2&quot;&gt;/etc/samba/smb.conf&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
[global]
    workgroup = OA
    security = ads
    winbind use default domain = no
    passdb backend = tdbsam
    password server = 1.1.1.1
    realm = OA.ABC.COM
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline3&quot;&gt;/etc/krb5.conf&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
[logging]
  default = FILE:/var/log/krb5libs.log
  kdc = FILE:/var/log/krb5kdc.log
  admin_server = FILE:/var/log/kadmind.log

[libdefaults]
  dns_lookup_realm = false
  ticket_lifetime = 24h
  renew_lifetime = 7d
  forwardable = true
  rdns = false
  default_realm = oa.abc.com
  #default_ccache_name = KEYRING:persistent:%{uid}

[realms]
  oa.abc.com = {
    kdc = 1.1.1.1:88
    admin_server = 1.1.1.1:749
  }

[domain_realm]
  .oa.abc.com = oa.abc.com
  oa.abc.com = oa.abc.com

[kdc]
 profile = /var/kerberos/krb5kdc/kdc.conf
[appdefaults]
  pam = {
    debug = false
    ticket_lifetime = 36000
    renew_lifetime = 36000
    forwardable = true
    krb4_convert = false
  }
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline4&quot;&gt;/etc/nsswitch.conf&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
passwd:     files sss winbind
shadow:     files sss winbind
group:      files sss winbind
protocols:  files winbind
services:   files sss winbind
netgroup:   files sss winbind
automount:  files winbind
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;启用服务&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;systemctl enable smb
systemctl enable winbind
systemctl start smb
systemctl start winbind
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline7&quot;&gt;测试&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;ntlm_auth --request-nt-key --domain=OA --username=wesley
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;
正常情况返回NT_STATUS_OK : Success (0x0)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline10&quot;&gt;Freeradius配置&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline8&quot;&gt;/etc/raddb/mods-enabled/ntlm_auth&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
exec ntlm_auth {
    wait = yes
    program = &quot;/usr/bin/ntlm_auth --request-nt-key --domain=OA.ABC.COM --username=%{mschap:User-Name} --password=%{User-Password}&quot;
}
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline9&quot;&gt;测试&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;radtest -t mschap -x -4 wesley 123456 localhost 10 testing123 0 127.0.0.1
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 03 Apr 2016 00:00:00 +0800</pubDate>
        <link>/network/freeradius-with-ad-ntlmauth.html</link>
        <guid isPermaLink="true">/network/freeradius-with-ad-ntlmauth.html</guid>
        
        <category>freeradius</category>
        
        
        <category>network</category>
        
      </item>
    
      <item>
        <title>Centos bonding基础上设置vlan与bridge</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;关闭NetworkManager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;加载bonding模块&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;配置bond接口&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;物理接口&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;nic01&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;nic02&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;bond子接口&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;bond0.905&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;bond0.906&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline12&quot;&gt;bridge接口&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;brnet06&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline11&quot;&gt;brnet11&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
为了提升系统可用性，一般会利用linux自带的bonding技术实现双网卡绑定。在虚拟机环境下，有时为了提高机器的使用效率，还需要在同一台机器配置不同的网段，这时可以通过vlan技术实现。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;关闭NetworkManager&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;service NetworkManager stop
chkconfig --level 2345 NetworkManager off
chkconfig --level 2345 network on
service network start
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;加载bonding模块&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;cat &amp;gt; /etc/modprobe.d/bonding.conf &amp;lt;&amp;lt; EOF
&lt;span style=&quot;font-weight: bold;&quot;&gt;alias bond0 bonding&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;EOF&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;配置bond接口&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;cat &amp;gt; /etc/sysconfig/network-scripts/ifcfg-bond0 &amp;lt;&amp;lt; EOF
&lt;span style=&quot;font-weight: bold;&quot;&gt;DEVICE=bond0&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;NAME=bond0&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;TYPE=bond&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;BONDING_MASTER=yes&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;BONDING_OPTS=&quot;mode=1 miimon=100&quot;&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;IPV6INIT=no&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;BOOTPROTO=none&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;ONBOOT=yes&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;MTU=9000&lt;/span&gt;
&lt;span style=&quot;font-weight: bold;&quot;&gt;EOF&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;物理接口&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline4&quot;&gt;nic01&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=ens2f0
NAME=ens2f0
TYPE=Ethernet
BOOTPROTO=none
ONBOOT=yes
MASTER=bond0
SLAVE=yes
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline5&quot;&gt;nic02&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=ens2f1
NAME=ens2f1
TYPE=Ethernet
BOOTPROTO=none
ONBOOT=yes
MASTER=bond0
SLAVE=yes
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline9&quot;&gt;bond子接口&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline7&quot;&gt;bond0.905&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=bond0.905
VLAN=yes
IPV6INIT=no
BOOTPROTO=none
ONBOOT=yes
BRIDGE=brnet11
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline8&quot;&gt;bond0.906&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=bond0.906
VLAN=yes
IPV6INIT=no
BOOTPROTO=none
ONBOOT=yes
BRIDGE=brnet06
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline12&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline12&quot;&gt;bridge接口&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline12&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline10&quot;&gt;brnet06&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=brnet06
BOOTPROTO=none
ONBOOT=yes
TYPE=Bridge
IPADDR=192.168.6.151
NETMASK=255.255.255.0
GATEWAY=192.168.6.254
IPV6INIT=no
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline11&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline11&quot;&gt;brnet11&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline11&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
DEVICE=brnet11
BOOTPROTO=none
ONBOOT=yes
TYPE=Bridge
IPV6INIT=no
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 17 Jan 2016 00:00:00 +0800</pubDate>
        <link>/linux/bonding-vlan-bridge.html</link>
        <guid isPermaLink="true">/linux/bonding-vlan-bridge.html</guid>
        
        <category>bond</category>
        
        <category>networking</category>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>ubuntu14.04安装Atheros QCA61x4无线网卡驱动</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;安装backports&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;下载并编译backports包&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;patch源代码&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;编译&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;安装配置ath10k firmware&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;测试&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
本文联想K20-80安装完ubuntu，发现无法自动识别无线网卡驱动。经查这是ubuntu的bug，影响到联想多款笔记本电脑，链接: &lt;a href=&quot;https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1436940&quot;&gt;Atheros wifi 168c:0041(QCA6164) is not supported&lt;/a&gt; 。本文纪录按#34楼建议解决问题的步骤，供以后查阅。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;安装backports&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline1&quot;&gt;下载并编译backports包&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;wget https://www.kernel.org/pub/linux/kernel/projects/backports/2015/07/31/backports-20150731.tar.gz
tar xvf backports-20150731.tar.gz
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; backports-20150731
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline2&quot;&gt;patch源代码&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
Patch the code with &lt;a href=&quot;https://github.com/atondwal/linux/commit/22f8a4083883eca3e8a3175315d67d2a04392466&quot;&gt;https://github.com/atondwal/linux/commit/22f8a4083883eca3e8a3175315d67d2a04392466&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline3&quot;&gt;编译&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;make defconfig-ath10k
make
sudo make install
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline5&quot;&gt;安装配置ath10k firmware&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;p&gt;
get the latest firmware from &lt;a href=&quot;https://github.com/kvalo/ath10k-firmware/archive/master.zip&quot;&gt;https://github.com/kvalo/ath10k-firmware/archive/master.zip&lt;/a&gt;
Unzip and copy ath10k folder to /lib/firmware/ath10k
&lt;/p&gt;

&lt;p&gt;
Copy these two files (overwrite what you got before) in /lib/firmware/ath10k/QCA6164/hw2.1:
&lt;a href=&quot;https://github.com/atondwal/ath10k-firmware/tree/master/ath10k/QCA6164/hw2.1&quot;&gt;https://github.com/atondwal/ath10k-firmware/tree/master/ath10k/QCA6164/hw2.1&lt;/a&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;rm -rf /lib/firmware/ath10k/QCA6174/hw3.0/
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
Create a file named /etc/modprobe.d/ath10k.conf with the following line:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
options ath10k_core skip_otp=y
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;测试&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;p&gt;
Reboot and modprobe ath10k_pci. Do &quot;lshw -C network&quot;; &quot;ip link show&quot; or &quot;rfkill list&quot; to see if you got your card working.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 03 Jan 2016 00:00:00 +0800</pubDate>
        <link>/linux/install-ath10k-wireless-driver-on-ubuntu.html</link>
        <guid isPermaLink="true">/linux/install-ath10k-wireless-driver-on-ubuntu.html</guid>
        
        <category>driver</category>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>持续集成工具之jenkins</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;jenkins安装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;插件安装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;配置环境&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;新建Job&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;SCM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;Build Triggers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline7&quot;&gt;Configure Maven&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline8&quot;&gt;Post Steps&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline11&quot;&gt;备机安装与数据同步&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline9&quot;&gt;同步脚本&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline10&quot;&gt;定期执行&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline12&quot;&gt;附录: Maven通过nexus下载构建的配置文件&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
本文介绍使用jenkins实现持续集成。
&lt;/p&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;jenkins安装&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;p&gt;
官方提供的是一个war包，可以直接放在tomcat容器中运行。jenkins不需要任何后台数据库支持，所有的变更纪录均放置在JENKINS_HOME，默认为~/.jenkins。
&lt;/p&gt;

&lt;p&gt;
单独运行jenkins的命令如下:
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
java -jar jenkins.war --httpPort=8081
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;插件安装&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
选择Manage Jenkins -&amp;gt; Manage Plugins进行插件的安装。如果CI服务器本身需要代理才能连接互联网，可以在Advanced中进行设置。常用的插件有Github Plugins，安装此插件同时会安装所依赖插件。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;配置环境&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;p&gt;
Manage Jenkins -&amp;gt; Configure System 此处设置JDK的HOME目录，Maven的目录, git可执行文件路径等。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;新建Job&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;p&gt;
输入Job的名称，此处以从git仓库clone Maven项目作为示例。
&lt;/p&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline5&quot;&gt;SCM&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;Source Code Management 选择git&lt;/li&gt;
&lt;li&gt;Repository URL: ssh://admin@gerrit:29418/reponame&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline6&quot;&gt;Build Triggers&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;Build when a change is pushed to GitHub (代码更新时build)&lt;/li&gt;
&lt;li&gt;Poll SCM (周期性从repo中checkout)&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&quot;example&quot;&gt;
*/10 * * * *
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline7&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline7&quot;&gt;Configure Maven&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline7&quot;&gt;
&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;Root POM : pom.xml&lt;/li&gt;
&lt;li&gt;Goals and options: clean install&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline8&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline8&quot;&gt;Post Steps&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline8&quot;&gt;
&lt;p&gt;
Execute shell
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;!/bin/&lt;/span&gt;&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;sh&lt;/span&gt;
&lt;span style=&quot;color: #633;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;copy built file to remote http server&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;project&lt;/span&gt;=easy-springmvc-maven
&lt;span style=&quot;color: #007;&quot;&gt;war_name&lt;/span&gt;=${&lt;span style=&quot;color: #007;&quot;&gt;project&lt;/span&gt;}.war
&lt;span style=&quot;color: #007;&quot;&gt;file_path&lt;/span&gt;=/root/.jenkins/jobs/${&lt;span style=&quot;color: #007;&quot;&gt;project&lt;/span&gt;}/workspace/target
&lt;span style=&quot;color: #007;&quot;&gt;now&lt;/span&gt;=$(date +&lt;span style=&quot;color: #800;&quot;&gt;&quot;%Y%m%d%H%M%S&quot;&lt;/span&gt;)

&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;cd&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;file_path&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ -f ${&lt;span style=&quot;color: #007;&quot;&gt;war_name&lt;/span&gt;} ]; &lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
scp ${&lt;span style=&quot;color: #007;&quot;&gt;war_name&lt;/span&gt;} root@filesrv01:/usr/share/nginx/html/files/dist/${&lt;span style=&quot;color: #007;&quot;&gt;project&lt;/span&gt;}-${&lt;span style=&quot;color: #007;&quot;&gt;now&lt;/span&gt;}.war
cp ${&lt;span style=&quot;color: #007;&quot;&gt;war_name&lt;/span&gt;} /opt/tomcat/webapps/${&lt;span style=&quot;color: #007;&quot;&gt;project&lt;/span&gt;}-${&lt;span style=&quot;color: #007;&quot;&gt;now&lt;/span&gt;}.war
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;else&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&quot;${war_name} unexists&quot;&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-orgheadline11&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline11&quot;&gt;备机安装与数据同步&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline11&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline9&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline9&quot;&gt;同步脚本&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline9&quot;&gt;
&lt;p&gt;
备机的安装方法与主机相同，数据通过如下脚本同步:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;!/bin/&lt;/span&gt;&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;sh&lt;/span&gt;
&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;script name:rsyncjenkins.sh&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&quot;/usr/bin/rsync&quot;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;-avz -e ssh --delete --bwlimit=8000&#39;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;/root/.jenkins&#39;&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;/var/log/rsyncjenkins&#39;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;=&lt;span style=&quot;font-weight: bold;&quot;&gt;`date +%Y-%m-%d`&lt;/span&gt;

&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;check function&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;check&lt;/span&gt; {
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ $&lt;span style=&quot;color: #007;&quot;&gt;?&lt;/span&gt; -eq 0 ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; -e &lt;span style=&quot;color: #800;&quot;&gt;&quot;33[1;32mRsync is success!33[0m&quot;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;else&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; -e &lt;span style=&quot;color: #800;&quot;&gt;&quot;33[1;31mRsync is fail!33[0m&quot;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;
}

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt; -d &lt;span style=&quot;color: #800;&quot;&gt;&quot;$jenkins_dir&quot;&lt;/span&gt; ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
mkdir -pv $&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt; -d &lt;span style=&quot;color: #800;&quot;&gt;&quot;$LogFileDir&quot;&lt;/span&gt; ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
mkdir -pv $&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&#39;Now start to rsync jenkins home directory!&#39;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt; root@tomcat01:$&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/jobs/ $&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/jobs/ &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt; root@tomcat01:$&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/plugins/ $&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/plugins/ &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt; root@tomcat01:$&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/*.xml $&lt;span style=&quot;color: #007;&quot;&gt;jenkins_dir&lt;/span&gt;/ &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFileDir&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
check&lt;span style=&quot;color: #800;&quot;&gt;&quot;]]&quot;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline10&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline10&quot;&gt;定期执行&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline10&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
00 00 * * * /bin/sh /root/sh/rsyncjenkins.sh &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
&lt;/pre&gt;

&lt;p&gt;
&lt;code&gt;备机需要重启容器才能加载新的配置。&lt;/code&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline12&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline12&quot;&gt;附录: Maven通过nexus下载构建的配置文件&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline12&quot;&gt;
&lt;p&gt;
cat ~/.m2/settings.xml
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-xml&quot;&gt;  &amp;lt;?&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;xml&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
  &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;settings&lt;/span&gt; &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;xmlns&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;http://maven.apache.org/SETTINGS/1.0.0&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;
            &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;xmlns&lt;/span&gt;:&lt;span style=&quot;color: #007;&quot;&gt;xsi&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;http://www.w3.org/2001/XMLSchema-instance&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;
            &lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;xsi&lt;/span&gt;:&lt;span style=&quot;color: #007;&quot;&gt;schemaLocation&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&lt;/span&gt;&lt;span style=&quot;color: #800;&quot;&gt;&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirrors&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirror&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;nexus&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirrorOf&lt;/span&gt;&amp;gt;*&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirrorOf&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;name&lt;/span&gt;&amp;gt;Nexus Public Mirror&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;name&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;http://nexusip:8081/nexus/content/groups/public&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;
      &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirror&lt;/span&gt;&amp;gt;
    &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;mirrors&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;profiles&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;profile&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;nexus&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;repositories&lt;/span&gt;&amp;gt;
          &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;repository&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;central&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;http://central&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;releases&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;true&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;releases&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;snapshots&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;true&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;snapshots&lt;/span&gt;&amp;gt;
          &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;repository&lt;/span&gt;&amp;gt;
        &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;repositories&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;pluginRepositories&lt;/span&gt;&amp;gt;
          &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;pluginRepository&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;central&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;id&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;http://central&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;url&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;releases&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;true&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;releases&lt;/span&gt;&amp;gt;
            &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;snapshots&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;true&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;enabled&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;snapshots&lt;/span&gt;&amp;gt;
          &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;pluginRepository&lt;/span&gt;&amp;gt;
        &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;pluginRepositories&lt;/span&gt;&amp;gt;
      &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;profile&lt;/span&gt;&amp;gt;
    &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;profiles&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;activeProfiles&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;activeProfile&lt;/span&gt;&amp;gt;nexus&amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;activeProfile&lt;/span&gt;&amp;gt;
    &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;activeProfiles&lt;/span&gt;&amp;gt;
  &amp;lt;/&lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;settings&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
主要配置mirror，因为*可通配所有路径，此时profile中的url已经没意义，所有的构建将全部通过mirror指定的链接，即nexus中的public repository group去下载。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 06 Dec 2015 00:00:00 +0800</pubDate>
        <link>/tools/jenkins-ci-setup.html</link>
        <guid isPermaLink="true">/tools/jenkins-ci-setup.html</guid>
        
        <category>jenkins</category>
        
        
        <category>tools</category>
        
      </item>
    
      <item>
        <title>Setup yum repository for centos 7</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;服务器端设置&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;rsync脚本&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;查看磁盘空间&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;nginx配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;定期同步&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline6&quot;&gt;客户端设置&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
搭建本地yum repository，重要意义如下:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;如企业内部服务器没有互联网连接，则可以通过本地repo服务器安装软件包，无需代理&lt;/li&gt;
&lt;li&gt;服务器通过yum安装软件包的速度将大大提高，这是因为下载方式将由互联网变更为局域网&lt;/li&gt;
&lt;/ul&gt;

&lt;!--abstract-end--&gt;


&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline5&quot;&gt;服务器端设置&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline1&quot;&gt;rsync脚本&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;!/bin/&lt;/span&gt;&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;bash&lt;/span&gt;
&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;script name:rsync_yumrepo.sh&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&quot;/usr/bin/rsync&quot;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;-avrt --delete --no-iconv --bwlimit=800&#39;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_base&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;/var/www/html/repos/centos/base/&#39;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_extras&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;/var/www/html/repos/centos/extras/&#39;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_updates&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;/var/www/html/repos/centos/updates/&#39;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_epel&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;/var/www/html/repos/centos/epel/&#39;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_mariadb&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;/var/www/html/repos/mariadb/10/0/&#39;&lt;/span&gt;

&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;=&lt;span style=&quot;color: #800;&quot;&gt;&#39;/var/log/rsyncyumrepo&#39;&lt;/span&gt;
&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;=&lt;span style=&quot;font-weight: bold;&quot;&gt;`date +%Y-%m-%d`&lt;/span&gt;

&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;check function&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color: #605; font-weight: bold;&quot;&gt;check&lt;/span&gt; {
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ $&lt;span style=&quot;color: #007;&quot;&gt;?&lt;/span&gt; -eq 0 ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; -e &lt;span style=&quot;color: #800;&quot;&gt;&quot;33[1;32mRsync is success!33[0m&quot;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;else&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; -e &lt;span style=&quot;color: #800;&quot;&gt;&quot;33[1;31mRsync is fail!33[0m&quot;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt; -d &lt;span style=&quot;color: #800;&quot;&gt;&quot;$Centos_7_base&quot;&lt;/span&gt; ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
mkdir -pv $&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_base&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt; -d &lt;span style=&quot;color: #800;&quot;&gt;&quot;$Centos_7_extras&quot;&lt;/span&gt; ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
mkdir -pv $&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_extras&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt; -d &lt;span style=&quot;color: #800;&quot;&gt;&quot;$Centos_7_updates&quot;&lt;/span&gt; ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
mkdir -pv $&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_updates&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt; -d &lt;span style=&quot;color: #800;&quot;&gt;&quot;$Centos_7_epel&quot;&lt;/span&gt; ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
mkdir -pv $&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_epel&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt; -d &lt;span style=&quot;color: #800;&quot;&gt;&quot;$Centos_7_mariadb&quot;&lt;/span&gt; ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
mkdir -pv $&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_mariadb&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;if&lt;/span&gt; [ &lt;span style=&quot;color: #C00;&quot;&gt;!&lt;/span&gt; -d &lt;span style=&quot;color: #800;&quot;&gt;&quot;$LogFile&quot;&lt;/span&gt; ];&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;then&lt;/span&gt;
mkdir -pv $&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;
&lt;span style=&quot;color: #800; font-weight: bold;&quot;&gt;fi&lt;/span&gt;

&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;rsync centos 7 base&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&#39;Now start to rsync centos 7 base!&#39;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt; rsync://mirrors.yun-idc.com/centos/7/os/ $&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_base&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
check

&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;rsync centos 7 extras&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&#39;Now start to rsync centos 7 extras!&#39;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt; rsync://mirrors.yun-idc.com/centos/7/extras/ $&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_extras&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
check

&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;rsync centos 7 updates&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&#39;Now start to rsync centos 7 updates!&#39;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt; rsync://mirrors.yun-idc.com/centos/7/updates/ $&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_updates&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
check

&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;rsync centos 7 epel&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&#39;Now start to rsync centos 7 epel!&#39;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt; $&lt;span style=&quot;color: #007;&quot;&gt;RsyncPerm&lt;/span&gt; --exclude=SRPMS/ --exclude=ppc64/ rsync://mirrors.yun-idc.com/epel/7/ $&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_epel&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
check

&lt;span style=&quot;color: #633;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #633;&quot;&gt;rsync centos 7 mariadb&lt;/span&gt;
&lt;span style=&quot;color: #058; font-weight: bold;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800;&quot;&gt;&#39;Now start to rsync centos 7 mariadb!&#39;&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
$&lt;span style=&quot;color: #007;&quot;&gt;RsyncBin&lt;/span&gt;  -vai4CH --safe-links --delay-updates --delete rsync://rsync.osuosl.org/mariadb/mariadb-10.0.22/yum/centos7-amd64/ $&lt;span style=&quot;color: #007;&quot;&gt;Centos_7_mariadb&lt;/span&gt; &amp;gt;&amp;gt;$&lt;span style=&quot;color: #007;&quot;&gt;LogFile&lt;/span&gt;/$&lt;span style=&quot;color: #007;&quot;&gt;Date&lt;/span&gt;.log
check
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline2&quot;&gt;查看磁盘空间&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;du -sch /var/www/html/repos/
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline3&quot;&gt;nginx配置&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
location /repos {
  root   /var/www/html;
  autoindex on;
}
&lt;/pre&gt;

&lt;p&gt;
open browser, try &lt;a href=&quot;http://hostname/repos&quot;&gt;http://hostname/repos&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgheadline4&quot;&gt;定期同步&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;pre class=&quot;example&quot;&gt;
30 02 * * * /bin/sh /root/sh/rsyncyumrepo.sh &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline6&quot;&gt;客户端设置&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline6&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;rm -rf /etc/yum.repos.d/*.repo
vi /etc/yum.repos.d/CentOS-Base.repo
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
repo文件内容如下:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
# filename: CentOS-Base.repo
#
[base]
name=CentOS-$releasever - Base
baseurl=http://reposrv/repos/centos/base/$basearch
gpgcheck=0


#released updates
[updates]
name=CentOS-$releasever - Updates
baseurl=http://reposrv/repos/centos/updates/$basearch
gpgcheck=0

#additional packages that may be useful
[extras]
name=CentOS-$releasever - Extras
baseurl=http://reposrv/repos/centos/extras/$basearch
gpgcheck=0

#additional packages From Epel Release
[epel]
name=CentOS-$releasever - Epel Release
baseurl=http://reposrv/repos/centos/epel/$basearch
gpgcheck=0

#Officail mariadb repo
[mariadb]
name=CentOS-$releasever - MariaDB
baseurl=http://reposrv/repos/mariadb/10/0/
gpgcheck=0
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Thu, 12 Nov 2015 00:00:00 +0800</pubDate>
        <link>/sysadmin/setup-local-yum-repo-for-centos7.html</link>
        <guid isPermaLink="true">/sysadmin/setup-local-yum-repo-for-centos7.html</guid>
        
        <category>yum</category>
        
        
        <category>sysadmin</category>
        
      </item>
    
      <item>
        <title>神奇的openssh</title>
        <description>&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline1&quot;&gt;SSH作socks代理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline2&quot;&gt;SSH作DNAT&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline3&quot;&gt;SSH X forward&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline4&quot;&gt;SSH作为文件传输协议&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgheadline5&quot;&gt;参考链接&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--abstract-begin--&gt;
&lt;p&gt;
openssh是管理服务器的一种通讯协议，本身包含加密功能。此外，openssh还有如下用途:
&lt;/p&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;socks代理&lt;/li&gt;
&lt;li&gt;目的端口转发&lt;/li&gt;
&lt;li&gt;x forward&lt;/li&gt;
&lt;li&gt;文件传输协议&lt;/li&gt;
&lt;/ul&gt;
&lt;!--abstract-end--&gt;

&lt;div id=&quot;outline-container-orgheadline1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline1&quot;&gt;SSH作socks代理&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline1&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;ssh -p 22 -qTfnN -D 0.0.0.0:1919 root@hostname
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
如此时连接hostname成功，则本机侦听1919，并可为其它机器提供socks代理服务。openssh同时支持socksv4与socksv5。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-orgheadline2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline2&quot;&gt;SSH作DNAT&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline2&quot;&gt;
&lt;p&gt;
假如A可以连接B，B可连接C，但A不能直连C。此时我们可以在B上开启端口转发，当A连接B的某端口时，实际连接的是机器C。
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;ssh -p 22 -qTfnN -g -L 33089:ip_of_c:3389 root@localhost
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
上述示例，我们在A上连接B的33089端口，实际连接的是机器C的3389端口。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline3&quot;&gt;SSH X forward&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline3&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;ssh -X &amp;lt;server&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
此时我们可以在本地运行server上的X程序，例如通过服务器上的wireshark gui抓包。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline4&quot;&gt;SSH作为文件传输协议&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline4&quot;&gt;
&lt;div class=&quot;org-src-container&quot;&gt;

&lt;pre class=&quot;src src-sh&quot;&gt;/usr/bin/rsync --delete -avz -e &lt;span style=&quot;color: #800;&quot;&gt;&#39;ssh -p 22222&#39;&lt;/span&gt; root@nginx01:/etc/nginx/ /etc/nginx/
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
&lt;code&gt;关于openssh sftp设置的方法，可参考下文&lt;/code&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;../sysadmin/openssh-sftp-setting.html&quot;&gt;OpenSSH SFTP chroot设置方法&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgheadline5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgheadline5&quot;&gt;参考链接&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgheadline5&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/&quot;&gt;实战SSH端口转发&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 01 Nov 2015 00:00:00 +0800</pubDate>
        <link>/sysadmin/amazing-openssh.html</link>
        <guid isPermaLink="true">/sysadmin/amazing-openssh.html</guid>
        
        <category>ssh</category>
        
        
        <category>sysadmin</category>
        
      </item>
    
  </channel>
</rss>
